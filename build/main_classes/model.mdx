<script>
import Tip from "../../Tip.svelte";
import Youtube from "../../Youtube.svelte";	
export let fw: "pt" | "tf"
</script>

<!--Copyright 2020 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
-->

# Models

The base classes [PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel), [TFPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel), and
[FlaxPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.FlaxPreTrainedModel) implement the common methods for loading/saving a model either from a local
file or directory, or from a pretrained model configuration provided by the library (downloaded from HuggingFace's AWS
S3 repository).

[PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel) and [TFPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel) also implement a few methods which
are common among all the models to:

- resize the input token embeddings when new tokens are added to the vocabulary
- prune the attention heads of the model.

The other methods that are common to each model are defined in [ModuleUtilsMixin](/docs/transformers/master/en/main_classes/model.html#transformers.modeling_utils.ModuleUtilsMixin)
(for the PyTorch models) and `TFModuleUtilsMixin` (for the TensorFlow models) or
for text generation, [GenerationMixin](/docs/transformers/master/en/main_classes/model.html#transformers.generation_utils.GenerationMixin) (for the PyTorch models),
[TFGenerationMixin](/docs/transformers/master/en/main_classes/model.html#transformers.generation_tf_utils.TFGenerationMixin) (for the TensorFlow models) and
[FlaxGenerationMixin](/docs/transformers/master/en/main_classes/model.html#transformers.generation_flax_utils.FlaxGenerationMixin) (for the Flax/JAX models).


## PreTrainedModel

<a id='transformers.PreTrainedModel'></a>
> **class transformers.PreTrainedModel**(config: PretrainedConfig, *inputs, **kwargs)


Base class for all models.

[PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel) takes care of storing the configuration of the models and handles methods
for loading, downloading and saving models as well as a few methods common to all models to:

- resize the input embeddings,
- prune heads in the self-attention heads.

Class attributes (overridden by derived classes):

- **config_class** ([PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig)) -- A subclass of
  [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig) to use as configuration class for this model architecture.
- **load_tf_weights** (`Callable`) -- A python _method_ for loading a TensorFlow checkpoint in a PyTorch
  model, taking as arguments:

  - **model** ([PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel)) -- An instance of the model on which to load the
    TensorFlow checkpoint.
  - **config** (`PreTrainedConfig`) -- An instance of the configuration associated to
    the model.
  - **path** (`str`) -- A path to the TensorFlow checkpoint.

- **base_model_prefix** (`str`) -- A string indicating the attribute associated to the base model in
  derived classes of the same architecture adding modules on top of the base model.
- **is_parallelizable** (`bool`) -- A flag indicating whether this model supports model parallelization.


<a id='transformers.file_utils.PushToHubMixin.push_to_hub'></a>
> **push\_to\_hub**(self, repo_path_or_name: typing.Optional[str] = None, repo_url: typing.Optional[str] = None, use_temp_dir: bool = False, commit_message: typing.Optional[str] = None, organization: typing.Optional[str] = None, private: typing.Optional[bool] = None, use_auth_token: typing.Union[bool, str, NoneType] = None)


Upload the model checkpoint to the ðŸ¤— Model Hub while synchronizing a local clone of the repo in
`repo_path_or_name`.

> Parameters

- **repo_path_or_name** (`str`, _optional_) --
  Can either be a repository name for your model in the Hub or a path to a local folder (in which case
  the repository will have the name of that local folder). If not specified, will default to the name
  given by `repo_url` and a local directory with that name will be created.
- **repo_url** (`str`, _optional_) --
  Specify this in case you want to push to an existing repository in the hub. If unspecified, a new
  repository will be created in your namespace (unless you specify an `organization`) with
  `repo_name`.
- **use_temp_dir** (`bool`, _optional_, defaults to `False`) --
  Whether or not to clone the distant repo in a temporary directory or in `repo_path_or_name` inside
  the current working directory. This will slow things down if you are making changes in an existing repo
  since you will need to clone the repo before every push.
- **commit_message** (`str`, _optional_) --
  Message to commit while pushing. Will default to `"add model"`.
- **organization** (`str`, _optional_) --
  Organization in which you want to push your model (you must be a member of this organization).
- **private** (`bool`, _optional_) --
  Whether or not the repository created should be private (requires a paying subscription).
- **use_auth_token** (`bool` or `str`, _optional_) --
  The token to use as HTTP bearer authorization for remote files. If `True`, will use the token
  generated when running `transformers-cli login` (stored in `~/.huggingface`). Will default to
  `True` if `repo_url` is not specified.


> Returns

The url of the commit of your model in the given repository.

> Return type

`str`

> Examples:

```python
from transformers import AutoModel

model = AutoModel.from_pretrained("bert-base-cased")

# Push the model to your namespace with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
model.push_to_hub("my-finetuned-bert")

# Push the model to your namespace with the name "my-finetuned-bert" with no local clone.
model.push_to_hub("my-finetuned-bert", use_temp_dir=True)

# Push the model to an organization with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
model.push_to_hub("my-finetuned-bert", organization="huggingface")

# Make a change to an existing repo that has been cloned locally in _my-finetuned-bert_.
model.push_to_hub("my-finetuned-bert", repo_url="https://huggingface.co/sgugger/my-finetuned-bert")
```


<a id='transformers.PreTrainedModel.from_pretrained'></a>
> **from\_pretrained**(pretrained_model_name_or_path: typing.Union[str, os.PathLike, NoneType], *model_args, **kwargs)


Instantiate a pretrained pytorch model from a pre-trained model configuration.

The model is set in evaluation mode by default using `model.eval()` (Dropout modules are deactivated). To
train the model, you should first set it back in training mode with `model.train()`.

The warning _Weights from XXX not initialized from pretrained model_ means that the weights of XXX do not come
pretrained with the rest of the model. It is up to you to train those weights with a downstream fine-tuning
task.

The warning _Weights from XXX not used in YYY_ means that the layer XXX is not used by YYY, therefore those
weights are discarded.

> Parameters

- **pretrained_model_name_or_path** (`str` or `os.PathLike`, _optional_) --
  Can be either:

  - A string, the _model id_ of a pretrained model hosted inside a model repo on huggingface.co.
    Valid model ids can be located at the root-level, like `bert-base-uncased`, or namespaced under
    a user or organization name, like `dbmdz/bert-base-german-cased`.
  - A path to a _directory_ containing model weights saved using
    [save_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel.save_pretrained), e.g., `./my_model_directory/`.
  - A path or url to a _tensorflow index checkpoint file_ (e.g, `./tf_model/model.ckpt.index`). In
    this case, `from_tf` should be set to `True` and a configuration object should be provided
    as `config` argument. This loading path is slower than converting the TensorFlow checkpoint in
    a PyTorch model using the provided conversion scripts and loading the PyTorch model afterwards.
  - A path or url to a model folder containing a _flax checkpoint file_ in _.msgpack_ format (e.g,
    `./flax_model/` containing `flax_model.msgpack`). In this case, `from_flax` should be set
    to `True`.
  - `None` if you are both providing the configuration and state dictionary (resp. with keyword
    arguments `config` and `state_dict`).
- **model_args** (sequence of positional arguments, _optional_) --
  All remaining positional arguments will be passed to the underlying model's `__init__` method.
- **config** (`Union[PretrainedConfig, str, os.PathLike]`, _optional_) --
  Can be either:

  - an instance of a class derived from [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig),
  - a string or path valid as input to [from_pretrained()](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig.from_pretrained).

Configuration for the model to use instead of an automatically loaded configuration. Configuration can
be automatically loaded when:

- The model is a model provided by the library (loaded with the _model id_ string of a pretrained
  model).
- The model was saved using [save_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel.save_pretrained) and is reloaded
  by supplying the save directory.
- The model is loaded by supplying a local directory as `pretrained_model_name_or_path` and a
  configuration JSON file named _config.json_ is found in the directory.
- **state_dict** (`Dict[str, torch.Tensor]`, _optional_) --
A state dictionary to use instead of a state dictionary loaded from saved weights file.

This option can be used if you want to create a model from a pretrained configuration but load your own
weights. In this case though, you should check if using
[save_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel.save_pretrained) and
[from_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel.from_pretrained) is not a simpler option.
  - **cache_dir** (`Union[str, os.PathLike]`, _optional_) --
    Path to a directory in which a downloaded pretrained model configuration should be cached if the
    standard cache should not be used.
- **from_tf** (`bool`, _optional_, defaults to `False`) --
  Load the model weights from a TensorFlow checkpoint save file (see docstring of
  `pretrained_model_name_or_path` argument).
- **from_flax** (`bool`, _optional_, defaults to `False`) --
  Load the model weights from a Flax checkpoint save file (see docstring of
  `pretrained_model_name_or_path` argument).
- **ignore_mismatched_sizes** (`bool`, _optional_, defaults to `False`) --
  Whether or not to raise an error if some of the weights from the checkpoint do not have the same size
  as the weights of the model (if for instance, you are instantiating a model with 10 labels from a
  checkpoint with 3 labels).
- **force_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to force the (re-)download of the model weights and configuration files, overriding the
  cached versions if they exist.
- **resume_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to delete incompletely received files. Will attempt to resume the download if such a
  file exists.
- **proxies** (`Dict[str, str]`, _optional_) --
  A dictionary of proxy servers to use by protocol or endpoint, e.g., `&amp;lcub;'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}`. The proxies are used on each request.
- **output_loading_info(`bool`,** _optional_, defaults to `False`) --
  Whether ot not to also return a dictionary containing missing keys, unexpected keys and error messages.
- **local_files_only(`bool`,** _optional_, defaults to `False`) --
  Whether or not to only look at local files (i.e., do not try to download the model).
- **use_auth_token** (`str` or _bool_, _optional_) --
  The token to use as HTTP bearer authorization for remote files. If `True`, will use the token
  generated when running `transformers-cli login` (stored in `~/.huggingface`).
- **revision(`str`,** _optional_, defaults to `"main"`) --
  The specific model version to use. It can be a branch name, a tag name, or a commit id, since we use a
  git-based system for storing models and other artifacts on huggingface.co, so `revision` can be any
  identifier allowed by git.
- **mirror(`str`,** _optional_) --
  Mirror source to accelerate downloads in China. If you are from China and have an accessibility
  problem, you can set this option to resolve it. Note that we do not guarantee the timeliness or safety.
  Please refer to the mirror site for more information.
- **_fast_init(`bool`,** _optional_, defaults to ```True`) --
  Whether or not to disable fast initialization.
- **low_cpu_mem_usage(`bool``,** _optional_, defaults to ```False`) --
  Tries to not use more than 1x model size in CPU memory (including peak memory) while loading the model.
  This is an experimental feature and a subject to change at any moment.
- **torch_dtype** (`str` or `torch.dtype`, _optional_) --
  Override the default `torch.dtype` and load the model under this dtype. If `"auto"` is passed the
  dtype will be automatically derived from the model's weights.

<Tip warning={true}>

One should only disable __fast_init_ to ensure backwards compatibility with
`transformers.__version__ &amp;lt; 4.6.0` for seeded model initialization. This argument will be removed
at the next major version. See [pull request 11471](https://github.com/huggingface/transformers/pull/11471) for more information.

</Tip>

- **kwargs** (remaining dictionary of keyword arguments, _optional_) --
  Can be used to update the configuration object (after it being loaded) and initiate the model (e.g.,
  `output_attentions=True`). Behaves differently depending on whether a `config` is provided or
  automatically loaded:

  - If a configuration is provided with `config`, `**kwargs` will be directly passed to the
    underlying model's `__init__` method (we assume all relevant updates to the configuration have
    already been done)
  - If a configuration is not provided, `kwargs` will be first passed to the configuration class
    initialization function ([from_pretrained()](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig.from_pretrained)). Each key of
    `kwargs` that corresponds to a configuration attribute will be used to override said attribute
    with the supplied `kwargs` value. Remaining keys that do not correspond to any configuration
    attribute will be passed to the underlying model's `__init__` function.

<Tip>

Passing `use_auth_token=True`` is required when you want to use a private model.

</Tip>

<Tip>

Activate the special ["offline-mode"](https://huggingface.co/transformers/installation.html#offline-mode) to use this method in a firewalled
environment.

</Tip>

> Examples:

```python
>>> from transformers import BertConfig, BertModel
>>> # Download model and configuration from huggingface.co and cache.
>>> model = BertModel.from_pretrained('bert-base-uncased')
>>> # Model was saved using _save_pretrained('./test/saved_model/')_ (for example purposes, not runnable).
>>> model = BertModel.from_pretrained('./test/saved_model/')
>>> # Update configuration during loading.
>>> model = BertModel.from_pretrained('bert-base-uncased', output_attentions=True)
>>> assert model.config.output_attentions == True
>>> # Loading from a TF checkpoint file instead of a PyTorch model (slower, for example purposes, not runnable).
>>> config = BertConfig.from_json_file('./tf_model/my_tf_model_config.json')
>>> model = BertModel.from_pretrained('./tf_model/my_tf_checkpoint.ckpt.index', from_tf=True, config=config)
>>> # Loading from a Flax checkpoint file instead of a PyTorch model (slower)
>>> model = BertModel.from_pretrained('bert-base-uncased', from_flax=True)
```


<a id='transformers.PreTrainedModel.get_input_embeddings'></a>
> **get\_input\_embeddings**(self)


Returns the model's input embeddings.

> Returns

A torch module mapping vocabulary to hidden states.

> Return type

`nn.Module`


<a id='transformers.PreTrainedModel.get_output_embeddings'></a>
> **get\_output\_embeddings**(self)


Returns the model's output embeddings.

> Returns

A torch module mapping hidden states to vocabulary.

> Return type

`nn.Module`


<a id='transformers.PreTrainedModel.gradient_checkpointing_disable'></a>
> **gradient\_checkpointing\_disable**(self)


Deactivates gradient checkpointing for the current model.

Note that in other frameworks this feature can be referred to as "activation checkpointing" or "checkpoint
activations".


<a id='transformers.PreTrainedModel.gradient_checkpointing_enable'></a>
> **gradient\_checkpointing\_enable**(self)


Activates gradient checkpointing for the current model.

Note that in other frameworks this feature can be referred to as "activation checkpointing" or "checkpoint
activations".


<a id='transformers.PreTrainedModel.init_weights'></a>
> **init\_weights**(self)


If needed prunes and maybe initializes weights.


<a id='transformers.PreTrainedModel.prune_heads'></a>
> **prune\_heads**(self, heads_to_prune: typing.Dict[int, typing.List[int]])


Prunes heads of the base model.

Arguments:
heads_to_prune (`Dict[int, List[int]]`):
Dictionary with keys being selected layer indices (`int`) and associated values being the list of
heads to prune in said layer (list of `int`). For instance &amp;lcub;1: [0, 2], 2: [2, 3]} will prune heads
0 and 2 on layer 1 and heads 2 and 3 on layer 2.


<a id='transformers.PreTrainedModel.resize_token_embeddings'></a>
> **resize\_token\_embeddings**(self, new_num_tokens: typing.Optional[int] = None)


Resizes input token embeddings matrix of the model if `new_num_tokens != config.vocab_size`.

Takes care of tying weights embeddings afterwards if the model class has a `tie_weights()` method.

Arguments:
new_num_tokens (`int`, _optional_):
The number of new tokens in the embedding matrix. Increasing the size will add newly initialized
vectors at the end. Reducing the size will remove vectors from the end. If not provided or `None`,
just returns a pointer to the input tokens `torch.nn.Embedding` module of the model without doing
anything.

> Returns

Pointer to the input tokens Embeddings Module of the model.

> Return type

`torch.nn.Embedding`


<a id='transformers.PreTrainedModel.save_pretrained'></a>
> **save\_pretrained**(self, save_directory: typing.Union[str, os.PathLike], save_config: bool = True, state_dict: typing.Optional[dict] = None, save_function: typing.Callable = <function save at 0x7fc1498dfc20>, push_to_hub: bool = False, **kwargs)


Save a model and its configuration file to a directory, so that it can be re-loaded using the
`[from_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel.from_pretrained)` class method.

Arguments:
save_directory (`str` or `os.PathLike`):
Directory to which to save. Will be created if it doesn't exist.
save_config (`bool`, _optional_, defaults to `True`):
Whether or not to save the config of the model. Useful when in distributed training like TPUs and need
to call this function on all processes. In this case, set `save_config=True` only on the main
process to avoid race conditions.
state_dict (nested dictionary of `torch.Tensor`):
The state dictionary of the model to save. Will default to `self.state_dict()`, but can be used to
only save parts of the model or if special precautions need to be taken when recovering the state
dictionary of a model (like when using model parallelism).
save_function (`Callable`):
The function to use to save the state dictionary. Useful on distributed training like TPUs when one
need to replace `torch.save` by another method.
push_to_hub (`bool`, _optional_, defaults to `False`):
Whether or not to push your model to the Hugging Face model hub after saving it.

<Tip warning={true}>

Using `push_to_hub=True` will synchronize the repository you are pushing to with
`save_directory`, which requires `save_directory` to be a local clone of the repo you are
pushing to if it's an existing folder. Pass along `temp_dir=True` to use a temporary directory
instead.

</Tip>

kwargs:
Additional key word arguments passed along to the
[push_to_hub()](/docs/transformers/master/en/main_classes/model.html#transformers.file_utils.PushToHubMixin.push_to_hub) method.


<a id='transformers.PreTrainedModel.set_input_embeddings'></a>
> **set\_input\_embeddings**(self, value: Module)


Set model's input embeddings.

> Parameters

- **value** (`nn.Module`) -- A module mapping vocabulary to hidden states.


<a id='transformers.PreTrainedModel.tie_weights'></a>
> **tie\_weights**(self)


Tie the weights between the input embeddings and the output embeddings.

If the `torchscript` flag is set in the configuration, can't handle parameter sharing so we are cloning
the weights instead.


<a id='from_pretrained-torch-dtype'></a>

### Model Instantiation dtype

Under Pytorch a model normally gets instantiated with `torch.float32` format. This can be an issue if one tries to
load a model whose weights are in fp16, since it'd require twice as much memory. To overcome this limitation, you can
either explicitly pass the desired `dtype` using `torch_dtype` argument:

```python
model = T5ForConditionalGeneration.from_pretrained("t5", torch_dtype=torch.float16)
```

or, if you want the model to always load in the most optimal memory pattern, you can use the special value `"auto"`,
and then `dtype` will be automatically derived from the model's weights:

```python
model = T5ForConditionalGeneration.from_pretrained("t5", torch_dtype="auto")
```

Models instantiated from scratch can also be told which `dtype` to use with:

```python
config = T5Config.from_pretrained("t5")
model = AutoModel.from_config(config)
```

Due to Pytorch design, this functionality is only available for floating dtypes.



## ModuleUtilsMixin

<a id='transformers.modeling_utils.ModuleUtilsMixin'></a>
> **class transformers.modeling\_utils.ModuleUtilsMixin**()


A few utilities for `torch.nn.Modules`, to be used as a mixin.


<a id='transformers.modeling_utils.ModuleUtilsMixin.add_memory_hooks'></a>
> **add\_memory\_hooks**(self)


Add a memory hook before and after each sub-module forward pass to record increase in memory consumption.

Increase in memory consumption is stored in a `mem_rss_diff` attribute for each module and can be reset to
zero with `model.reset_memory_hooks_state()`.


<a id='transformers.modeling_utils.ModuleUtilsMixin.estimate_tokens'></a>
> **estimate\_tokens**(self, input_dict: typing.Dict[str, typing.Union[torch.Tensor, typing.Any]])


Helper function to estimate the total number of tokens from the model inputs.

> Parameters

- **inputs** (`dict`) -- The model inputs.

> Returns

The total number of tokens.

> Return type

`int`


<a id='transformers.modeling_utils.ModuleUtilsMixin.floating_point_ops'></a>
> **floating\_point\_ops**(self, input_dict: typing.Dict[str, typing.Union[torch.Tensor, typing.Any]], exclude_embeddings: bool = True)


Get number of (optionally, non-embeddings) floating-point operations for the forward and backward passes of a
batch with this transformer model. Default approximation neglects the quadratic dependency on the number of
tokens (valid if `12 * d_model << sequence_length`) as laid out in [this paper](https://arxiv.org/pdf/2001.08361.pdf) section 2.1. Should be overridden for transformers with parameter
re-use e.g. Albert or Universal Transformers, or if doing long-range modeling with very high sequence lengths.

> Parameters

- **batch_size** (`int`) --
  The batch size for the forward pass.

- **sequence_length** (`int`) --
  The number of tokens in each line of the batch.

- **exclude_embeddings** (`bool`, _optional_, defaults to `True`) --
  Whether or not to count embedding and softmax operations.

> Returns

The number of floating-point operations.

> Return type

`int`


<a id='transformers.modeling_utils.ModuleUtilsMixin.get_extended_attention_mask'></a>
> **get\_extended\_attention\_mask**(self, attention_mask: Tensor, input_shape: typing.Tuple[int], device: <property object at 0x7fbfb94a18f0>)


Makes broadcastable attention and causal masks so that future and masked tokens are ignored.

Arguments:
attention_mask (`torch.Tensor`):
Mask with ones indicating tokens to attend to, zeros for tokens to ignore.
input_shape (`Tuple[int]`):
The shape of the input to the model.
device: (`torch.device`):
The device of the input to the model.

> Returns

`torch.Tensor` The extended attention mask, with a the same dtype as `attention_mask.dtype`.


<a id='transformers.modeling_utils.ModuleUtilsMixin.get_head_mask'></a>
> **get\_head\_mask**(self, head_mask: typing.Optional[torch.Tensor], num_hidden_layers: int, is_attention_chunked: bool = False)


Prepare the head mask if needed.

> Parameters

- **head_mask** (`torch.Tensor` with shape `[num_heads]` or `[num_hidden_layers x num_heads]`, _optional_) --
  The mask indicating if we should keep the heads or not (1.0 for keep, 0.0 for discard).
- **num_hidden_layers** (`int`) --
  The number of hidden layers in the model.
  is_attention_chunked -- (`bool`, _optional_, defaults to `False`):
  Whether or not the attentions scores are computed by chunks or not.

> Returns

`torch.Tensor` with shape `[num_hidden_layers x batch x num_heads x seq_length x seq_length]` or
list with `[None]` for each layer.


<a id='transformers.modeling_utils.ModuleUtilsMixin.invert_attention_mask'></a>
> **invert\_attention\_mask**(self, encoder_attention_mask: Tensor)


Invert an attention mask (e.g., switches 0. and 1.).

> Parameters

- **encoder_attention_mask** (`torch.Tensor`) -- An attention mask.

> Returns

The inverted attention mask.

> Return type

`torch.Tensor`


<a id='transformers.modeling_utils.ModuleUtilsMixin.num_parameters'></a>
> **num\_parameters**(self, only_trainable: bool = False, exclude_embeddings: bool = False)


Get number of (optionally, trainable or non-embeddings) parameters in the module.

> Parameters

- **only_trainable** (`bool`, _optional_, defaults to `False`) --
  Whether or not to return only the number of trainable parameters

- **exclude_embeddings** (`bool`, _optional_, defaults to `False`) --
  Whether or not to return only the number of non-embeddings parameters

> Returns

The number of parameters.

> Return type

`int`


<a id='transformers.modeling_utils.ModuleUtilsMixin.reset_memory_hooks_state'></a>
> **reset\_memory\_hooks\_state**(self)


Reset the `mem_rss_diff` attribute of each module (see
[add_memory_hooks()](/docs/transformers/master/en/main_classes/model.html#transformers.modeling_utils.ModuleUtilsMixin.add_memory_hooks)).


## TFPreTrainedModel

<a id='transformers.TFPreTrainedModel'></a>
> **class transformers.TFPreTrainedModel**(*args, **kwargs)


Base class for all TF models.

[TFPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel) takes care of storing the configuration of the models and handles methods
for loading, downloading and saving models as well as a few methods common to all models to:

- resize the input embeddings,
- prune heads in the self-attention heads.

Class attributes (overridden by derived classes):

- **config_class** ([PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig)) -- A subclass of
  [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig) to use as configuration class for this model architecture.
- **base_model_prefix** (`str`) -- A string indicating the attribute associated to the base model in
  derived classes of the same architecture adding modules on top of the base model.


<a id='transformers.file_utils.PushToHubMixin.push_to_hub'></a>
> **push\_to\_hub**(self, repo_path_or_name: typing.Optional[str] = None, repo_url: typing.Optional[str] = None, use_temp_dir: bool = False, commit_message: typing.Optional[str] = None, organization: typing.Optional[str] = None, private: typing.Optional[bool] = None, use_auth_token: typing.Union[bool, str, NoneType] = None)


Upload the model checkpoint to the ðŸ¤— Model Hub while synchronizing a local clone of the repo in
`repo_path_or_name`.

> Parameters

- **repo_path_or_name** (`str`, _optional_) --
  Can either be a repository name for your model in the Hub or a path to a local folder (in which case
  the repository will have the name of that local folder). If not specified, will default to the name
  given by `repo_url` and a local directory with that name will be created.
- **repo_url** (`str`, _optional_) --
  Specify this in case you want to push to an existing repository in the hub. If unspecified, a new
  repository will be created in your namespace (unless you specify an `organization`) with
  `repo_name`.
- **use_temp_dir** (`bool`, _optional_, defaults to `False`) --
  Whether or not to clone the distant repo in a temporary directory or in `repo_path_or_name` inside
  the current working directory. This will slow things down if you are making changes in an existing repo
  since you will need to clone the repo before every push.
- **commit_message** (`str`, _optional_) --
  Message to commit while pushing. Will default to `"add model"`.
- **organization** (`str`, _optional_) --
  Organization in which you want to push your model (you must be a member of this organization).
- **private** (`bool`, _optional_) --
  Whether or not the repository created should be private (requires a paying subscription).
- **use_auth_token** (`bool` or `str`, _optional_) --
  The token to use as HTTP bearer authorization for remote files. If `True`, will use the token
  generated when running `transformers-cli login` (stored in `~/.huggingface`). Will default to
  `True` if `repo_url` is not specified.


> Returns

The url of the commit of your model in the given repository.

> Return type

`str`

> Examples:

```python
from transformers import TFAutoModel

model = TFAutoModel.from_pretrained("bert-base-cased")

# Push the model to your namespace with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
model.push_to_hub("my-finetuned-bert")

# Push the model to your namespace with the name "my-finetuned-bert" with no local clone.
model.push_to_hub("my-finetuned-bert", use_temp_dir=True)

# Push the model to an organization with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
model.push_to_hub("my-finetuned-bert", organization="huggingface")

# Make a change to an existing repo that has been cloned locally in _my-finetuned-bert_.
model.push_to_hub("my-finetuned-bert", repo_url="https://huggingface.co/sgugger/my-finetuned-bert")
```


<a id='transformers.TFPreTrainedModel.compile'></a>
> **compile**(self, optimizer = rmsprop, loss = passthrough, metrics = None, loss_weights = None, weighted_metrics = None, run_eagerly = None, steps_per_execution = None, **kwargs)


This is a thin wrapper that sets the model's loss output head as the loss if the user does not specify a loss
function themselves.


<a id='transformers.TFPreTrainedModel.from_pretrained'></a>
> **from\_pretrained**(pretrained_model_name_or_path, *model_args, **kwargs)


Instantiate a pretrained TF 2.0 model from a pre-trained model configuration.

The warning _Weights from XXX not initialized from pretrained model_ means that the weights of XXX do not come
pretrained with the rest of the model. It is up to you to train those weights with a downstream fine-tuning
task.

The warning _Weights from XXX not used in YYY_ means that the layer XXX is not used by YYY, therefore those
weights are discarded.

> Parameters

- **pretrained_model_name_or_path** (`str`, _optional_) --
  Can be either:

  - A string, the _model id_ of a pretrained model hosted inside a model repo on huggingface.co.
    Valid model ids can be located at the root-level, like `bert-base-uncased`, or namespaced under
    a user or organization name, like `dbmdz/bert-base-german-cased`.
  - A path to a _directory_ containing model weights saved using
    [save_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel.save_pretrained), e.g., `./my_model_directory/`.
  - A path or url to a _PyTorch state_dict save file_ (e.g, `./pt_model/pytorch_model.bin`). In
    this case, `from_pt` should be set to `True` and a configuration object should be provided
    as `config` argument. This loading path is slower than converting the PyTorch model in a
    TensorFlow model using the provided conversion scripts and loading the TensorFlow model
    afterwards.
  - `None` if you are both providing the configuration and state dictionary (resp. with keyword
    arguments `config` and `state_dict`).
- **model_args** (sequence of positional arguments, _optional_) --
  All remaining positional arguments will be passed to the underlying model's `__init__` method.
- **config** (`Union[PretrainedConfig, str]`, _optional_) --
  Can be either:

  - an instance of a class derived from [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig),
  - a string valid as input to [from_pretrained()](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig.from_pretrained).

Configuration for the model to use instead of an automatically loaded configuration. Configuration can
be automatically loaded when:

- The model is a model provided by the library (loaded with the _model id_ string of a pretrained
  model).
- The model was saved using [save_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel.save_pretrained) and is reloaded
  by supplying the save directory.
- The model is loaded by supplying a local directory as `pretrained_model_name_or_path` and a
  configuration JSON file named _config.json_ is found in the directory.
from_pt -- (`bool`, _optional_, defaults to `False`):
Load the model weights from a PyTorch state_dict save file (see docstring of
`pretrained_model_name_or_path` argument).
- **ignore_mismatched_sizes** (`bool`, _optional_, defaults to `False`) --
  Whether or not to raise an error if some of the weights from the checkpoint do not have the same size
  as the weights of the model (if for instance, you are instantiating a model with 10 labels from a
  checkpoint with 3 labels).
- **cache_dir** (`str`, _optional_) --
  Path to a directory in which a downloaded pretrained model configuration should be cached if the
  standard cache should not be used.
- **force_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to force the (re-)download of the model weights and configuration files, overriding the
  cached versions if they exist.
- **resume_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to delete incompletely received files. Will attempt to resume the download if such a
  file exists.
  proxies -- (`Dict[str, str], `optional`): A dictionary of proxy servers to use by protocol or endpoint, e.g., `&amp;lcub;'http': 'foo.bar:3128',
  'http://hostname': 'foo.bar:4012'}`. The proxies are used on each request. - **output_loading_info(`bool`,** _optional_, defaults to `False`) --
  Whether ot not to also return a dictionary containing missing keys, unexpected keys and error messages.
- **local_files_only(`bool`,** _optional_, defaults to `False`) --
  Whether or not to only look at local files (e.g., not try doanloading the model).
- **use_auth_token** (`str` or _bool_, _optional_) --
  The token to use as HTTP bearer authorization for remote files. If `True`, will use the token
  generated when running `transformers-cli login` (stored in `~/.huggingface`).
- **revision(`str`,** _optional_, defaults to `"main"`) --
  The specific model version to use. It can be a branch name, a tag name, or a commit id, since we use a
  git-based system for storing models and other artifacts on huggingface.co, so `revision` can be any
  identifier allowed by git.
- **mirror(`str`,** _optional_) --
  Mirror source to accelerate downloads in China. If you are from China and have an accessibility
  problem, you can set this option to resolve it. Note that we do not guarantee the timeliness or safety.
  Please refer to the mirror site for more information.
- **kwargs** (remaining dictionary of keyword arguments, _optional_) --
  Can be used to update the configuration object (after it being loaded) and initiate the model (e.g.,
  `output_attentions=True`). Behaves differently depending on whether a `config` is provided or
  automatically loaded:

  - If a configuration is provided with `config`, `**kwargs` will be directly passed to the
    underlying model's `__init__` method (we assume all relevant updates to the configuration have
    already been done)
  - If a configuration is not provided, `kwargs` will be first passed to the configuration class
    initialization function ([from_pretrained()](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig.from_pretrained)). Each key of
    `kwargs` that corresponds to a configuration attribute will be used to override said attribute
    with the supplied `kwargs` value. Remaining keys that do not correspond to any configuration
    attribute will be passed to the underlying model's `__init__` function.

<Tip>

Passing `use_auth_token=True` is required when you want to use a private model.

</Tip>

> Examples:

```python
>>> from transformers import BertConfig, TFBertModel
>>> # Download model and configuration from huggingface.co and cache.
>>> model = TFBertModel.from_pretrained('bert-base-uncased')
>>> # Model was saved using _save_pretrained('./test/saved_model/')_ (for example purposes, not runnable).
>>> model = TFBertModel.from_pretrained('./test/saved_model/')
>>> # Update configuration during loading.
>>> model = TFBertModel.from_pretrained('bert-base-uncased', output_attentions=True)
>>> assert model.config.output_attentions == True
>>> # Loading from a Pytorch model file instead of a TensorFlow checkpoint (slower, for example purposes, not runnable).
>>> config = BertConfig.from_json_file('./pt_model/my_pt_model_config.json')
>>> model = TFBertModel.from_pretrained('./pt_model/my_pytorch_model.bin', from_pt=True, config=config)
```


<a id='transformers.TFPreTrainedModel.get_bias'></a>
> **get\_bias**(self)


Dict of bias attached to an LM head. The key represents the name of the bias attribute.

> Returns

The weights representing the bias, None if not an LM model.

> Return type

`tf.Variable`


<a id='transformers.TFPreTrainedModel.get_input_embeddings'></a>
> **get\_input\_embeddings**(self)


Returns the model's input embeddings layer.

> Returns

The embeddings layer mapping vocabulary to hidden states.

> Return type

`tf.Variable`


<a id='transformers.TFPreTrainedModel.get_lm_head'></a>
> **get\_lm\_head**(self)


The LM Head layer. This method must be overwritten by all the models that have a lm head.

> Returns

The LM head layer if the model has one, None if not.

> Return type

`tf.keras.layers.Layer`


<a id='transformers.TFPreTrainedModel.get_output_embeddings'></a>
> **get\_output\_embeddings**(self)


Returns the model's output embeddings

> Returns

The new weights mapping vocabulary to hidden states.

> Return type

`tf.Variable`


<a id='transformers.TFPreTrainedModel.get_output_layer_with_bias'></a>
> **get\_output\_layer\_with\_bias**(self)


Get the layer that handles a bias attribute in case the model has an LM head with weights tied to the
embeddings

> Returns

The layer that handles the bias, None if not an LM model.

> Return type

`tf.keras.layers.Layer`


<a id='transformers.TFPreTrainedModel.get_prefix_bias_name'></a>
> **get\_prefix\_bias\_name**(self)


Get the concatenated _prefix name of the bias from the model name to the parent layer

> Returns

The _prefix name of the bias.

> Return type

`str`


<a id='transformers.TFPreTrainedModel.prune_heads'></a>
> **prune\_heads**(self, heads_to_prune)


Prunes heads of the base model.

Arguments:
heads_to_prune (`Dict[int, List[int]]`):
Dictionary with keys being selected layer indices (`int`) and associated values being the list of
heads to prune in said layer (list of `int`). For instance &amp;lcub;1: [0, 2], 2: [2, 3]} will prune heads
0 and 2 on layer 1 and heads 2 and 3 on layer 2.


<a id='transformers.TFPreTrainedModel.resize_token_embeddings'></a>
> **resize\_token\_embeddings**(self, new_num_tokens = None)


Resizes input token embeddings matrix of the model if `new_num_tokens != config.vocab_size`.

Takes care of tying weights embeddings afterwards if the model class has a `tie_weights()` method.

Arguments:
new_num_tokens (`int`, _optional_):
The number of new tokens in the embedding matrix. Increasing the size will add newly initialized
vectors at the end. Reducing the size will remove vectors from the end. If not provided or `None`,
just returns a pointer to the input tokens `tf.Variable` module of the model without doing
anything.

> Returns

Pointer to the input tokens Embeddings Module of the model.

> Return type

`tf.Variable`


<a id='transformers.TFPreTrainedModel.save_pretrained'></a>
> **save\_pretrained**(self, save_directory, saved_model = False, version = 1, push_to_hub = False, **kwargs)


Save a model and its configuration file to a directory, so that it can be re-loaded using the
[from_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel.from_pretrained) class method.

Arguments:
save_directory (`str`):
Directory to which to save. Will be created if it doesn't exist.
saved_model (`bool`, _optional_, defaults to `False`):
If the model has to be saved in saved model format as well or not.
version (`int`, _optional_, defaults to 1):
The version of the saved model. A saved model needs to be versioned in order to be properly loaded by
TensorFlow Serving as detailed in the official documentation
https://www.tensorflow.org/tfx/serving/serving_basic
push_to_hub (`bool`, _optional_, defaults to `False`):
Whether or not to push your model to the Hugging Face model hub after saving it.

<Tip warning={true}>

Using `push_to_hub=True` will synchronize the repository you are pushing to with
`save_directory`, which requires `save_directory` to be a local clone of the repo you are
pushing to if it's an existing folder. Pass along `temp_dir=True` to use a temporary directory
instead.

</Tip>

kwargs:
Additional key word arguments passed along to the
[push_to_hub()](/docs/transformers/master/en/main_classes/model.html#transformers.file_utils.PushToHubMixin.push_to_hub) method.


<a id='transformers.TFPreTrainedModel.serving'></a>
> **serving**(self, inputs)


Method used for serving the model.

> Parameters

- **inputs** (`Dict[str, tf.Tensor]`) --
  The input of the saved model as a dictionary of tensors.


<a id='transformers.TFPreTrainedModel.serving_output'></a>
> **serving\_output**(output)


Prepare the output of the saved model. Each model must implement this function.

> Parameters

- **output** (`~transformers.TFBaseModelOutput`) --
  The output returned by the model.


<a id='transformers.TFPreTrainedModel.set_bias'></a>
> **set\_bias**(self, value)


Set all the bias in the LM head.

> Parameters

- **value** (`Dict[tf.Variable]`) --
  All the new bias attached to an LM head.


<a id='transformers.TFPreTrainedModel.set_input_embeddings'></a>
> **set\_input\_embeddings**(self, value)


Set model's input embeddings

> Parameters

- **value** (`tf.Variable`) --
  The new weights mapping hidden states to vocabulary.


<a id='transformers.TFPreTrainedModel.set_output_embeddings'></a>
> **set\_output\_embeddings**(self, value)


Set model's output embeddings

> Parameters

- **value** (`tf.Variable`) --
  The new weights mapping hidden states to vocabulary.


<a id='transformers.TFPreTrainedModel.test_step'></a>
> **test\_step**(self, data)


A modification of Keras's default test_step that cleans up the printed metrics when we use a dummy loss.


<a id='transformers.TFPreTrainedModel.train_step'></a>
> **train\_step**(self, data)


A modification of Keras's default train_step that cleans up the printed metrics when we use a dummy loss.


## TFModelUtilsMixin

<a id='transformers.modeling_tf_utils.TFModelUtilsMixin'></a>
> **class transformers.modeling\_tf\_utils.TFModelUtilsMixin**()


A few utilities for `tf.keras.Model`, to be used as a mixin.


<a id='transformers.modeling_tf_utils.TFModelUtilsMixin.num_parameters'></a>
> **num\_parameters**(self, only_trainable: bool = False)


Get the number of (optionally, trainable) parameters in the model.

> Parameters

- **only_trainable** (`bool`, _optional_, defaults to `False`) --
  Whether or not to return only the number of trainable parameters

> Returns

The number of parameters.

> Return type

`int`


## FlaxPreTrainedModel

<a id='transformers.FlaxPreTrainedModel'></a>
> **class transformers.FlaxPreTrainedModel**(config: PretrainedConfig, module: Module, input_shape: typing.Tuple = (1, 1), seed: int = 0, dtype: dtype = <class 'jax._src.numpy.lax_numpy.float32'>)


Base class for all models.

[FlaxPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.FlaxPreTrainedModel) takes care of storing the configuration of the models and handles
methods for loading, downloading and saving models.

Class attributes (overridden by derived classes):

- **config_class** ([PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig)) -- A subclass of
  [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig) to use as configuration class for this model architecture.
- **base_model_prefix** (`str`) -- A string indicating the attribute associated to the base model in
  derived classes of the same architecture adding modules on top of the base model.


<a id='transformers.file_utils.PushToHubMixin.push_to_hub'></a>
> **push\_to\_hub**(self, repo_path_or_name: typing.Optional[str] = None, repo_url: typing.Optional[str] = None, use_temp_dir: bool = False, commit_message: typing.Optional[str] = None, organization: typing.Optional[str] = None, private: typing.Optional[bool] = None, use_auth_token: typing.Union[bool, str, NoneType] = None)


Upload the model checkpoint to the ðŸ¤— Model Hub while synchronizing a local clone of the repo in
`repo_path_or_name`.

> Parameters

- **repo_path_or_name** (`str`, _optional_) --
  Can either be a repository name for your model in the Hub or a path to a local folder (in which case
  the repository will have the name of that local folder). If not specified, will default to the name
  given by `repo_url` and a local directory with that name will be created.
- **repo_url** (`str`, _optional_) --
  Specify this in case you want to push to an existing repository in the hub. If unspecified, a new
  repository will be created in your namespace (unless you specify an `organization`) with
  `repo_name`.
- **use_temp_dir** (`bool`, _optional_, defaults to `False`) --
  Whether or not to clone the distant repo in a temporary directory or in `repo_path_or_name` inside
  the current working directory. This will slow things down if you are making changes in an existing repo
  since you will need to clone the repo before every push.
- **commit_message** (`str`, _optional_) --
  Message to commit while pushing. Will default to `"add model"`.
- **organization** (`str`, _optional_) --
  Organization in which you want to push your model (you must be a member of this organization).
- **private** (`bool`, _optional_) --
  Whether or not the repository created should be private (requires a paying subscription).
- **use_auth_token** (`bool` or `str`, _optional_) --
  The token to use as HTTP bearer authorization for remote files. If `True`, will use the token
  generated when running `transformers-cli login` (stored in `~/.huggingface`). Will default to
  `True` if `repo_url` is not specified.


> Returns

The url of the commit of your model in the given repository.

> Return type

`str`

> Examples:

```python
from transformers import FlaxAutoModel

model = FlaxAutoModel.from_pretrained("bert-base-cased")

# Push the model to your namespace with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
model.push_to_hub("my-finetuned-bert")

# Push the model to your namespace with the name "my-finetuned-bert" with no local clone.
model.push_to_hub("my-finetuned-bert", use_temp_dir=True)

# Push the model to an organization with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
model.push_to_hub("my-finetuned-bert", organization="huggingface")

# Make a change to an existing repo that has been cloned locally in _my-finetuned-bert_.
model.push_to_hub("my-finetuned-bert", repo_url="https://huggingface.co/sgugger/my-finetuned-bert")
```


<a id='transformers.FlaxPreTrainedModel.from_pretrained'></a>
> **from\_pretrained**(pretrained_model_name_or_path: typing.Union[str, os.PathLike], dtype: dtype = <class 'jax._src.numpy.lax_numpy.float32'>, *model_args, **kwargs)


Instantiate a pretrained flax model from a pre-trained model configuration.

The warning _Weights from XXX not initialized from pretrained model_ means that the weights of XXX do not come
pretrained with the rest of the model. It is up to you to train those weights with a downstream fine-tuning
task.

The warning _Weights from XXX not used in YYY_ means that the layer XXX is not used by YYY, therefore those
weights are discarded.

> Parameters

- **pretrained_model_name_or_path** (`str` or `os.PathLike`) --
  Can be either:

  - A string, the _model id_ of a pretrained model hosted inside a model repo on huggingface.co.
    Valid model ids can be located at the root-level, like `bert-base-uncased`, or namespaced under
    a user or organization name, like `dbmdz/bert-base-german-cased`.
  - A path to a _directory_ containing model weights saved using
    [save_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.FlaxPreTrainedModel.save_pretrained), e.g., `./my_model_directory/`.
  - A path or url to a _pt index checkpoint file_ (e.g, `./tf_model/model.ckpt.index`). In this
    case, `from_pt` should be set to `True`.
- **model_args** (sequence of positional arguments, _optional_) --
  All remaining positional arguments will be passed to the underlying model's `__init__` method.
- **config** (`Union[PretrainedConfig, str, os.PathLike]`, _optional_) --
  Can be either:

  - an instance of a class derived from [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig),
  - a string or path valid as input to [from_pretrained()](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig.from_pretrained).

Configuration for the model to use instead of an automatically loaded configuration. Configuration can
be automatically loaded when:

- The model is a model provided by the library (loaded with the _model id_ string of a pretrained
  model).
- The model was saved using [save_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel.save_pretrained) and is reloaded
  by supplying the save directory.
- The model is loaded by supplying a local directory as `pretrained_model_name_or_path` and a
  configuration JSON file named _config.json_ is found in the directory.
- **cache_dir** (`Union[str, os.PathLike]`, _optional_) --
Path to a directory in which a downloaded pretrained model configuration should be cached if the
standard cache should not be used.
  - **from_pt** (`bool`, _optional_, defaults to `False`) --
    Load the model weights from a PyTorch checkpoint save file (see docstring of
    `pretrained_model_name_or_path` argument).
- **ignore_mismatched_sizes** (`bool`, _optional_, defaults to `False`) --
  Whether or not to raise an error if some of the weights from the checkpoint do not have the same size
  as the weights of the model (if for instance, you are instantiating a model with 10 labels from a
  checkpoint with 3 labels).
- **force_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to force the (re-)download of the model weights and configuration files, overriding the
  cached versions if they exist.
- **resume_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to delete incompletely received files. Will attempt to resume the download if such a
  file exists.
- **proxies** (`Dict[str, str]`, _optional_) --
  A dictionary of proxy servers to use by protocol or endpoint, e.g., `&amp;lcub;'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}`. The proxies are used on each request.
- **local_files_only(`bool`,** _optional_, defaults to `False`) --
  Whether or not to only look at local files (i.e., do not try to download the model).
- **revision(`str`,** _optional_, defaults to `"main"`) --
  The specific model version to use. It can be a branch name, a tag name, or a commit id, since we use a
  git-based system for storing models and other artifacts on huggingface.co, so `revision` can be any
  identifier allowed by git.
- **kwargs** (remaining dictionary of keyword arguments, _optional_) --
  Can be used to update the configuration object (after it being loaded) and initiate the model (e.g.,
  `output_attentions=True`). Behaves differently depending on whether a `config` is provided or
  automatically loaded:

  - If a configuration is provided with `config`, `**kwargs` will be directly passed to the
    underlying model's `__init__` method (we assume all relevant updates to the configuration have
    already been done)
  - If a configuration is not provided, `kwargs` will be first passed to the configuration class
    initialization function ([from_pretrained()](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig.from_pretrained)). Each key of
    `kwargs` that corresponds to a configuration attribute will be used to override said attribute
    with the supplied `kwargs` value. Remaining keys that do not correspond to any configuration
    attribute will be passed to the underlying model's `__init__` function.

> Examples:

```python
>>> from transformers import BertConfig, FlaxBertModel
>>> # Download model and configuration from huggingface.co and cache.
>>> model = FlaxBertModel.from_pretrained('bert-base-cased')
>>> # Model was saved using _save_pretrained('./test/saved_model/')_ (for example purposes, not runnable).
>>> model = FlaxBertModel.from_pretrained('./test/saved_model/')
>>> # Loading from a PyTorch checkpoint file instead of a PyTorch model (slower, for example purposes, not runnable).
>>> config = BertConfig.from_json_file('./pt_model/config.json')
>>> model = FlaxBertModel.from_pretrained('./pt_model/pytorch_model.bin', from_pt=True, config=config)
```


<a id='transformers.FlaxPreTrainedModel.save_pretrained'></a>
> **save\_pretrained**(self, save_directory: typing.Union[str, os.PathLike], params = None, push_to_hub = False, **kwargs)


Save a model and its configuration file to a directory, so that it can be re-loaded using the
`[from_pretrained()](/docs/transformers/master/en/main_classes/model.html#transformers.FlaxPreTrainedModel.from_pretrained)` class method

Arguments:
save_directory (`str` or `os.PathLike`):
Directory to which to save. Will be created if it doesn't exist.
push_to_hub (`bool`, _optional_, defaults to `False`):
Whether or not to push your model to the Hugging Face model hub after saving it.

<Tip warning={true}>

Using `push_to_hub=True` will synchronize the repository you are pushing to with
`save_directory`, which requires `save_directory` to be a local clone of the repo you are
pushing to if it's an existing folder. Pass along `temp_dir=True` to use a temporary directory
instead.

</Tip>

kwargs:
Additional key word arguments passed along to the
[push_to_hub()](/docs/transformers/master/en/main_classes/model.html#transformers.file_utils.PushToHubMixin.push_to_hub) method.


## Generation

<a id='transformers.generation_utils.GenerationMixin'></a>
> **class transformers.generation\_utils.GenerationMixin**()


A class containing all of the functions supporting generation, to be used as a mixin in
[PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel).


<a id='transformers.generation_utils.GenerationMixin.adjust_logits_during_generation'></a>
> **adjust\_logits\_during\_generation**(self, logits: FloatTensor, **kwargs)


Implement in subclasses of [PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel) for custom behavior to adjust the logits in
the generate method.


<a id='transformers.generation_utils.GenerationMixin.beam_sample'></a>
> **beam\_sample**(self, input_ids: LongTensor, beam_scorer: BeamScorer, logits_processor: typing.Optional[transformers.generation_logits_process.LogitsProcessorList] = None, stopping_criteria: typing.Optional[transformers.generation_stopping_criteria.StoppingCriteriaList] = None, logits_warper: typing.Optional[transformers.generation_logits_process.LogitsProcessorList] = None, max_length: typing.Optional[int] = None, pad_token_id: typing.Optional[int] = None, eos_token_id: typing.Optional[int] = None, output_attentions: typing.Optional[bool] = None, output_hidden_states: typing.Optional[bool] = None, output_scores: typing.Optional[bool] = None, return_dict_in_generate: typing.Optional[bool] = None, synced_gpus: typing.Optional[bool] = None, **model_kwargs)


Generates sequences for models with a language modeling head using beam search with multinomial sampling.

> Parameters


- **input_ids** (`torch.LongTensor` of shape `(batch_size, sequence_length)`) --
  The sequence used as a prompt for the generation.
- **beam_scorer** (`BeamScorer`) --
  A derived instance of [BeamScorer](/docs/transformers/master/en/internal/generation_utils.html#transformers.BeamScorer) that defines how beam hypotheses are
  constructed, stored and sorted during generation. For more information, the documentation of
  [BeamScorer](/docs/transformers/master/en/internal/generation_utils.html#transformers.BeamScorer) should be read.
- **logits_processor** (`LogitsProcessorList`, _optional_) --
  An instance of [LogitsProcessorList](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessorList). List of instances of class derived from
  [LogitsProcessor](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessor) used to modify the prediction scores of the language modeling
  head applied at each generation step.
- **stopping_criteria** (`StoppingCriteriaList`, _optional_) --
  An instance of [StoppingCriteriaList](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteriaList). List of instances of class derived from
  [StoppingCriteria](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteria) used to tell if the generation loop should stop.
- **logits_warper** (`LogitsProcessorList`, _optional_) --
  An instance of [LogitsProcessorList](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessorList). List of instances of class derived from
  [LogitsWarper](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsWarper) used to warp the prediction score distribution of the language
  modeling head applied before multinomial sampling at each generation step.
- **max_length** (`int`, _optional_, defaults to 20) --
  **DEPRECATED**. Use `logits_processor` or `stopping_criteria` directly to cap the number of
  generated tokens. The maximum length of the sequence to be generated.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **output_attentions** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the attentions tensors of all attention layers. See `attentions` under
  returned tensors for more details.
- **output_hidden_states** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the hidden states of all layers. See `hidden_states` under returned tensors
  for more details.
- **output_scores** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the prediction scores. See `scores` under returned tensors for more details.
- **return_dict_in_generate** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return a [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) instead of a plain tuple.
- **synced_gpus** (`bool`, _optional_, defaults to `False`) --
  Whether to continue running the while loop until max_length (needed for ZeRO stage 3)
  model_kwargs --
  Additional model specific kwargs will be forwarded to the `forward` function of the model. If
  model is an encoder-decoder model the kwargs should include `encoder_outputs`.

> Returns

[BeamSampleDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSampleDecoderOnlyOutput),
[BeamSampleEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSampleEncoderDecoderOutput) or obj:_torch.LongTensor_: A
`torch.LongTensor` containing the generated tokens (default behaviour) or a
[BeamSampleDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSampleDecoderOnlyOutput) if
`model.config.is_encoder_decoder=False` and `return_dict_in_generate=True` or a
[BeamSampleEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSampleEncoderDecoderOutput) if
`model.config.is_encoder_decoder=True`.

> Examples:

```python
>>> from transformers import (
...     AutoTokenizer,
...     AutoModelForSeq2SeqLM,
...     LogitsProcessorList,
...     MinLengthLogitsProcessor,
...     TopKLogitsWarper,
...     TemperatureLogitsWarper,
...     BeamSearchScorer,
... )
>>> import torch

>>> tokenizer = AutoTokenizer.from_pretrained("t5-base")
>>> model = AutoModelForSeq2SeqLM.from_pretrained("t5-base")

>>> encoder_input_str = "translate English to German: How old are you?"
>>> encoder_input_ids = tokenizer(encoder_input_str, return_tensors="pt").input_ids

>>> # lets run beam search using 3 beams
>>> num_beams = 3
>>> # define decoder start token ids
>>> input_ids = torch.ones((num_beams, 1), device=model.device, dtype=torch.long)
>>> input_ids = input_ids * model.config.decoder_start_token_id

>>> # add encoder_outputs to model keyword arguments
>>> model_kwargs = &amp;lcub;
...     "encoder_outputs": model.get_encoder()(encoder_input_ids.repeat_interleave(num_beams, dim=0), return_dict=True)
... }

>>> # instantiate beam scorer
>>> beam_scorer = BeamSearchScorer(
...     batch_size=1,
...     max_length=model.config.max_length,
...     num_beams=num_beams,
...     device=model.device,
... )

>>> # instantiate logits processors
>>> logits_processor = LogitsProcessorList([
...     MinLengthLogitsProcessor(5, eos_token_id=model.config.eos_token_id)
... ])
>>> # instantiate logits processors
>>> logits_warper = LogitsProcessorList([
...     TopKLogitsWarper(50),
...     TemperatureLogitsWarper(0.7),
... ])

>>> outputs = model.beam_sample(
...     input_ids, beam_scorer, logits_processor=logits_processor, logits_warper=logits_warper, **model_kwargs
... )

>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))
```


<a id='transformers.generation_utils.GenerationMixin.beam_search'></a>
> **beam\_search**(self, input_ids: LongTensor, beam_scorer: BeamScorer, logits_processor: typing.Optional[transformers.generation_logits_process.LogitsProcessorList] = None, stopping_criteria: typing.Optional[transformers.generation_stopping_criteria.StoppingCriteriaList] = None, max_length: typing.Optional[int] = None, pad_token_id: typing.Optional[int] = None, eos_token_id: typing.Optional[int] = None, output_attentions: typing.Optional[bool] = None, output_hidden_states: typing.Optional[bool] = None, output_scores: typing.Optional[bool] = None, return_dict_in_generate: typing.Optional[bool] = None, synced_gpus: typing.Optional[bool] = None, **model_kwargs)


Generates sequences for models with a language modeling head using beam search decoding.

> Parameters


- **input_ids** (`torch.LongTensor` of shape `(batch_size, sequence_length)`) --
  The sequence used as a prompt for the generation.
- **beam_scorer** (`BeamScorer`) --
  An derived instance of [BeamScorer](/docs/transformers/master/en/internal/generation_utils.html#transformers.BeamScorer) that defines how beam hypotheses are
  constructed, stored and sorted during generation. For more information, the documentation of
  [BeamScorer](/docs/transformers/master/en/internal/generation_utils.html#transformers.BeamScorer) should be read.
- **logits_processor** (`LogitsProcessorList`, _optional_) --
  An instance of [LogitsProcessorList](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessorList). List of instances of class derived from
  [LogitsProcessor](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessor) used to modify the prediction scores of the language modeling
  head applied at each generation step.
- **stopping_criteria** (`StoppingCriteriaList`, _optional_) --
  An instance of [StoppingCriteriaList](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteriaList). List of instances of class derived from
  [StoppingCriteria](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteria) used to tell if the generation loop should stop.
- **max_length** (`int`, _optional_, defaults to 20) --
  **DEPRECATED**. Use `logits_processor` or `stopping_criteria` directly to cap the number of
  generated tokens. The maximum length of the sequence to be generated.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **output_attentions** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the attentions tensors of all attention layers. See `attentions` under
  returned tensors for more details.
- **output_hidden_states** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the hidden states of all layers. See `hidden_states` under returned tensors
  for more details.
- **output_scores** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the prediction scores. See `scores` under returned tensors for more details.
- **return_dict_in_generate** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return a [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) instead of a plain tuple.
- **synced_gpus** (`bool`, _optional_, defaults to `False`) --
  Whether to continue running the while loop until max_length (needed for ZeRO stage 3)
  model_kwargs --
  Additional model specific kwargs will be forwarded to the `forward` function of the model. If
  model is an encoder-decoder model the kwargs should include `encoder_outputs`.

> Returns

`generation_utilsBeamSearchDecoderOnlyOutput`,
[BeamSearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchEncoderDecoderOutput) or obj:_torch.LongTensor_: A
`torch.LongTensor` containing the generated tokens (default behaviour) or a
[BeamSearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchDecoderOnlyOutput) if
`model.config.is_encoder_decoder=False` and `return_dict_in_generate=True` or a
[BeamSearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchEncoderDecoderOutput) if
`model.config.is_encoder_decoder=True`.


> Examples:

```python
>>> from transformers import (
...    AutoTokenizer,
...    AutoModelForSeq2SeqLM,
...    LogitsProcessorList,
...    MinLengthLogitsProcessor,
...    BeamSearchScorer,
... )
>>> import torch

>>> tokenizer = AutoTokenizer.from_pretrained("t5-base")
>>> model = AutoModelForSeq2SeqLM.from_pretrained("t5-base")

>>> encoder_input_str = "translate English to German: How old are you?"
>>> encoder_input_ids = tokenizer(encoder_input_str, return_tensors="pt").input_ids


>>> # lets run beam search using 3 beams
>>> num_beams = 3
>>> # define decoder start token ids
>>> input_ids = torch.ones((num_beams, 1), device=model.device, dtype=torch.long)
>>> input_ids = input_ids * model.config.decoder_start_token_id

>>> # add encoder_outputs to model keyword arguments
>>> model_kwargs = &amp;lcub;
...     "encoder_outputs": model.get_encoder()(encoder_input_ids.repeat_interleave(num_beams, dim=0), return_dict=True)
... }

>>> # instantiate beam scorer
>>> beam_scorer = BeamSearchScorer(
...     batch_size=1,
...     num_beams=num_beams,
...     device=model.device,
... )

>>> # instantiate logits processors
>>> logits_processor = LogitsProcessorList([
...     MinLengthLogitsProcessor(5, eos_token_id=model.config.eos_token_id),
... ])

>>> outputs = model.beam_search(input_ids, beam_scorer, logits_processor=logits_processor, **model_kwargs)

>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))
```


<a id='transformers.generation_utils.GenerationMixin.generate'></a>
> **generate**(self, input_ids: typing.Optional[torch.LongTensor] = None, max_length: typing.Optional[int] = None, min_length: typing.Optional[int] = None, do_sample: typing.Optional[bool] = None, early_stopping: typing.Optional[bool] = None, num_beams: typing.Optional[int] = None, temperature: typing.Optional[float] = None, top_k: typing.Optional[int] = None, top_p: typing.Optional[float] = None, repetition_penalty: typing.Optional[float] = None, bad_words_ids: typing.Optional[typing.Iterable[int]] = None, bos_token_id: typing.Optional[int] = None, pad_token_id: typing.Optional[int] = None, eos_token_id: typing.Optional[int] = None, length_penalty: typing.Optional[float] = None, no_repeat_ngram_size: typing.Optional[int] = None, encoder_no_repeat_ngram_size: typing.Optional[int] = None, num_return_sequences: typing.Optional[int] = None, max_time: typing.Optional[float] = None, max_new_tokens: typing.Optional[int] = None, decoder_start_token_id: typing.Optional[int] = None, use_cache: typing.Optional[bool] = None, num_beam_groups: typing.Optional[int] = None, diversity_penalty: typing.Optional[float] = None, prefix_allowed_tokens_fn: typing.Union[typing.Callable[[int, torch.Tensor], typing.List[int]], NoneType] = None, output_attentions: typing.Optional[bool] = None, output_hidden_states: typing.Optional[bool] = None, output_scores: typing.Optional[bool] = None, return_dict_in_generate: typing.Optional[bool] = None, forced_bos_token_id: typing.Optional[int] = None, forced_eos_token_id: typing.Optional[int] = None, remove_invalid_values: typing.Optional[bool] = None, synced_gpus: typing.Optional[bool] = None, **model_kwargs)


Generates sequences for models with a language modeling head. The method currently supports greedy decoding,
multinomial sampling, beam-search decoding, and beam-search multinomial sampling.

Apart from `input_ids` and `attention_mask`, all the arguments below will default to the value of the
attribute of the same name inside the [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig) of the model. The default values
indicated are the default values of those config.

Most of these parameters are explained in more detail in [this blog post](https://huggingface.co/blog/how-to-generate).

> Parameters


- **input_ids** (`torch.LongTensor` of shape `(batch_size, sequence_length)`, _optional_) --
  The sequence used as a prompt for the generation. If `None` the method initializes it with
  `bos_token_id` and a batch size of 1.
- **max_length** (`int`, _optional_, defaults to `model.config.max_length`) --
  The maximum length of the sequence to be generated.
- **max_new_tokens** (`int`, _optional_, defaults to None) --
  The maximum numbers of tokens to generate, ignore the current number of tokens. Use either
  `max_new_tokens` or `max_length` but not both, they serve the same purpose.
- **min_length** (`int`, _optional_, defaults to 10) --
  The minimum length of the sequence to be generated.
- **do_sample** (`bool`, _optional_, defaults to `False`) --
  Whether or not to use sampling ; use greedy decoding otherwise.
- **early_stopping** (`bool`, _optional_, defaults to `False`) --
  Whether to stop the beam search when at least `num_beams` sentences are finished per batch or not.
- **num_beams** (`int`, _optional_, defaults to 1) --
  Number of beams for beam search. 1 means no beam search.
- **temperature** (`float`, _optional_, defaults to 1.0) --
  The value used to module the next token probabilities.
- **top_k** (`int`, _optional_, defaults to 50) --
  The number of highest probability vocabulary tokens to keep for top-k-filtering.
- **top_p** (`float`, _optional_, defaults to 1.0) --
  If set to float &amp;lt; 1, only the most probable tokens with probabilities that add up to `top_p` or
  higher are kept for generation.
- **repetition_penalty** (`float`, _optional_, defaults to 1.0) --
  The parameter for repetition penalty. 1.0 means no penalty. See [this paper](https://arxiv.org/pdf/1909.05858.pdf) for more details.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **bos_token_id** (`int`, _optional_) --
  The id of the _beginning-of-sequence_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **length_penalty** (`float`, _optional_, defaults to 1.0) --
  Exponential penalty to the length. 1.0 means no penalty. Set to values &amp;lt; 1.0 in order to encourage the
  model to generate shorter sequences, to a value > 1.0 in order to encourage the model to produce longer
  sequences.
- **no_repeat_ngram_size** (`int`, _optional_, defaults to 0) --
  If set to int > 0, all ngrams of that size can only occur once.
- **encoder_no_repeat_ngram_size** (`int`, _optional_, defaults to 0) --
  If set to int > 0, all ngrams of that size that occur in the `encoder_input_ids` cannot occur in the
  `decoder_input_ids`.
- **bad_words_ids(`List[List[int]]`,** _optional_) --
  List of token ids that are not allowed to be generated. In order to get the tokens of the words that
  should not appear in the generated text, use `tokenizer(bad_word, add_prefix_space=True).input_ids`.
- **num_return_sequences(`int`,** _optional_, defaults to 1) --
  The number of independently computed returned sequences for each element in the batch.
- **max_time(`float`,** _optional_, defaults to None) --
  The maximum amount of time you allow the computation to run for in seconds. generation will still
  finish the current pass after allocated time has been passed.
- **attention_mask** (`torch.LongTensor` of shape `(batch_size, sequence_length)`, _optional_) --
  Mask to avoid performing attention on padding token indices. Mask values are in `[0, 1]`, 1 for
  tokens that are not masked, and 0 for masked tokens. If not provided, will default to a tensor the same
  shape as `input_ids` that masks the pad token. [What are attention masks?](../glossary.html#attention-mask)
- **decoder_start_token_id** (`int`, _optional_) --
  If an encoder-decoder model starts decoding with a different token than _bos_, the id of that token.
  use_cache -- (`bool`, _optional_, defaults to `True`):
  Whether or not the model should use the past last key/values attentions (if applicable to the model) to
  speed up decoding.
- **num_beam_groups** (`int`, _optional_, defaults to 1) --
  Number of groups to divide `num_beams` into in order to ensure diversity among different groups of
  beams. [this paper](https://arxiv.org/pdf/1610.02424.pdf) for more details.
- **diversity_penalty** (`float`, _optional_, defaults to 0.0) --
  This value is subtracted from a beam's score if it generates a token same as any beam from other group
  at a particular time. Note that `diversity_penalty` is only effective if `group beam search` is
  enabled.
  prefix_allowed_tokens_fn -- (`Callable[[int, torch.Tensor], List[int]]`, _optional_):
  If provided, this function constraints the beam search to allowed tokens only at each step. If not
  provided no constraint is applied. This function takes 2 arguments: the batch ID `batch_id` and
  `input_ids`. It has to return a list with the allowed tokens for the next generation step
  conditioned on the batch ID `batch_id` and the previously generated tokens `inputs_ids`. This
  argument is useful for constrained generation conditioned on the prefix, as described in
  [Autoregressive Entity Retrieval](https://arxiv.org/abs/2010.00904).
- **output_attentions** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the attentions tensors of all attention layers. See `attentions` under
  returned tensors for more details.
- **output_hidden_states** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the hidden states of all layers. See `hidden_states` under returned tensors
  for more details.
- **output_scores** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the prediction scores. See `scores` under returned tensors for more details.
- **return_dict_in_generate** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return a [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) instead of a plain tuple.
- **forced_bos_token_id** (`int`, _optional_) --
  The id of the token to force as the first generated token after the `decoder_start_token_id`.
  Useful for multilingual models like [mBART](/docs/transformers/master/en/../model_doc/mbart.html) where the first generated token
  needs to be the target language token.
- **forced_eos_token_id** (`int`, _optional_) --
  The id of the token to force as the last generated token when `max_length` is reached.
- **remove_invalid_values** (`bool`, _optional_) --
  Whether to remove possible _nan_ and _inf_ outputs of the model to prevent the generation method to
  crash. Note that using `remove_invalid_values` can slow down generation.
- **synced_gpus** (`bool`, _optional_, defaults to `False`) --
  Whether to continue running the while loop until max_length (needed for ZeRO stage 3)

  model_kwargs --
  Additional model specific kwargs will be forwarded to the `forward` function of the model. If the
  model is an encoder-decoder model, encoder specific kwargs should not be prefixed and decoder specific
  kwargs should be prefixed with _decoder__.

> Returns

A
[ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) (if `return_dict_in_generate=True` or when
`config.return_dict_in_generate=True`) or a `torch.FloatTensor`.

If the model is _not_ an encoder-decoder model (`model.config.is_encoder_decoder=False`), the
possible [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) types are:

- [GreedySearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.GreedySearchDecoderOnlyOutput),
- [SampleDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.SampleDecoderOnlyOutput),
- [BeamSearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchDecoderOnlyOutput),
- [BeamSampleDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSampleDecoderOnlyOutput)

If the model is an encoder-decoder model (`model.config.is_encoder_decoder=True`), the possible
[ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) types are:

- [GreedySearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.GreedySearchEncoderDecoderOutput),
- [SampleEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.SampleEncoderDecoderOutput),
- [BeamSearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchEncoderDecoderOutput),
- [BeamSampleEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSampleEncoderDecoderOutput)

> Return type

[ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) or `torch.LongTensor`

> Examples:

```python
>>> from transformers import AutoTokenizer, AutoModelForCausalLM, AutoModelForSeq2SeqLM

>>> tokenizer = AutoTokenizer.from_pretrained("distilgpt2")
>>> model = AutoModelForCausalLM.from_pretrained("distilgpt2")
>>> # do greedy decoding without providing a prompt
>>> outputs = model.generate(max_length=40)
>>> print("Generated:", tokenizer.decode(outputs[0], skip_special_tokens=True))

>>> tokenizer = AutoTokenizer.from_pretrained("t5-base")
>>> model = AutoModelForSeq2SeqLM.from_pretrained("t5-base")
>>> document = (
... "at least two people were killed in a suspected bomb attack on a passenger bus "
... "in the strife-torn southern philippines on monday , the military said."
... )
>>> # encode input context
>>> input_ids = tokenizer(document, return_tensors="pt").input_ids
>>> # generate 3 independent sequences using beam search decoding (5 beams)
>>> # with T5 encoder-decoder model conditioned on short news article.
>>> outputs = model.generate(input_ids=input_ids, num_beams=5, num_return_sequences=3)
>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))

>>> tokenizer = AutoTokenizer.from_pretrained("distilgpt2")
>>> model = AutoModelForCausalLM.from_pretrained("distilgpt2")
>>> input_context = "The dog"
>>> # encode input context
>>> input_ids = tokenizer(input_context, return_tensors="pt").input_ids
>>> # generate 3 candidates using sampling
>>> outputs = model.generate(input_ids=input_ids, max_length=20, num_return_sequences=3, do_sample=True)
>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))

>>> tokenizer = AutoTokenizer.from_pretrained("ctrl")
>>> model = AutoModelForCausalLM.from_pretrained("ctrl")
>>> # "Legal" is one of the control codes for ctrl
>>> input_context = "Legal My neighbor is"
>>> # encode input context
>>> input_ids = tokenizer(input_context, return_tensors="pt").input_ids
>>> outputs = model.generate(input_ids=input_ids, max_length=20, repetition_penalty=1.2)
>>> print("Generated:", tokenizer.decode(outputs[0], skip_special_tokens=True))

>>> tokenizer = AutoTokenizer.from_pretrained("gpt2")
>>> model = AutoModelForCausalLM.from_pretrained("gpt2")
>>> input_context = "My cute dog"
>>> # get tokens of words that should not be generated
>>> bad_words_ids = [tokenizer(bad_word, add_prefix_space=True).input_ids for bad_word in ["idiot", "stupid", "shut up"]]
>>> # encode input context
>>> input_ids = tokenizer(input_context, return_tensors="pt").input_ids
>>> # generate sequences without allowing bad_words to be generated
>>> outputs = model.generate(input_ids=input_ids, max_length=20, do_sample=True, bad_words_ids=bad_words_ids)
>>> print("Generated:", tokenizer.decode(outputs[0], skip_special_tokens=True))
```


<a id='transformers.generation_utils.GenerationMixin.greedy_search'></a>
> **greedy\_search**(self, input_ids: LongTensor, logits_processor: typing.Optional[transformers.generation_logits_process.LogitsProcessorList] = None, stopping_criteria: typing.Optional[transformers.generation_stopping_criteria.StoppingCriteriaList] = None, max_length: typing.Optional[int] = None, pad_token_id: typing.Optional[int] = None, eos_token_id: typing.Optional[int] = None, output_attentions: typing.Optional[bool] = None, output_hidden_states: typing.Optional[bool] = None, output_scores: typing.Optional[bool] = None, return_dict_in_generate: typing.Optional[bool] = None, synced_gpus: typing.Optional[bool] = None, **model_kwargs)


Generates sequences for models with a language modeling head using greedy decoding.

> Parameters


- **input_ids** (`torch.LongTensor` of shape `(batch_size, sequence_length)`) --
  The sequence used as a prompt for the generation.
- **logits_processor** (`LogitsProcessorList`, _optional_) --
  An instance of [LogitsProcessorList](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessorList). List of instances of class derived from
  [LogitsProcessor](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessor) used to modify the prediction scores of the language modeling
  head applied at each generation step.
- **stopping_criteria** (`StoppingCriteriaList`, _optional_) --
  An instance of [StoppingCriteriaList](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteriaList). List of instances of class derived from
  [StoppingCriteria](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteria) used to tell if the generation loop should stop.

- **max_length** (`int`, _optional_, defaults to 20) --
  **DEPRECATED**. Use `logits_processor` or `stopping_criteria` directly to cap the number of
  generated tokens. The maximum length of the sequence to be generated.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **output_attentions** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the attentions tensors of all attention layers. See `attentions` under
  returned tensors for more details.
- **output_hidden_states** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the hidden states of all layers. See `hidden_states` under returned tensors
  for more details.
- **output_scores** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the prediction scores. See `scores` under returned tensors for more details.
- **return_dict_in_generate** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return a [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) instead of a plain tuple.
- **synced_gpus** (`bool`, _optional_, defaults to `False`) --
  Whether to continue running the while loop until max_length (needed for ZeRO stage 3)
  model_kwargs --
  Additional model specific keyword arguments will be forwarded to the `forward` function of the
  model. If model is an encoder-decoder model the kwargs should include `encoder_outputs`.

> Returns

[GreedySearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.GreedySearchDecoderOnlyOutput),
[GreedySearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.GreedySearchEncoderDecoderOutput) or obj:_torch.LongTensor_: A
`torch.LongTensor` containing the generated tokens (default behaviour) or a
[GreedySearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.GreedySearchDecoderOnlyOutput) if
`model.config.is_encoder_decoder=False` and `return_dict_in_generate=True` or a
[GreedySearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.GreedySearchEncoderDecoderOutput) if
`model.config.is_encoder_decoder=True`.

> Examples:

```python
>>> from transformers import (
... AutoTokenizer,
... AutoModelForCausalLM,
... LogitsProcessorList,
... MinLengthLogitsProcessor,
... )

>>> tokenizer = AutoTokenizer.from_pretrained("gpt2")
>>> model = AutoModelForCausalLM.from_pretrained("gpt2")

>>> # set pad_token_id to eos_token_id because GPT2 does not have a EOS token
>>> model.config.pad_token_id = model.config.eos_token_id

>>> input_prompt = "Today is a beautiful day, and"
>>> input_ids = tokenizer(input_prompt, return_tensors="pt").input_ids

>>> # instantiate logits processors
>>> logits_processor = LogitsProcessorList([
...     MinLengthLogitsProcessor(15, eos_token_id=model.config.eos_token_id),
... ])

>>> outputs = model.greedy_search(input_ids, logits_processor=logits_processor)

>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))
```


<a id='transformers.generation_utils.GenerationMixin.group_beam_search'></a>
> **group\_beam\_search**(self, input_ids: LongTensor, beam_scorer: BeamScorer, logits_processor: typing.Optional[transformers.generation_logits_process.LogitsProcessorList] = None, stopping_criteria: typing.Optional[transformers.generation_stopping_criteria.StoppingCriteriaList] = None, max_length: typing.Optional[int] = None, pad_token_id: typing.Optional[int] = None, eos_token_id: typing.Optional[int] = None, output_attentions: typing.Optional[bool] = None, output_hidden_states: typing.Optional[bool] = None, output_scores: typing.Optional[bool] = None, return_dict_in_generate: typing.Optional[bool] = None, synced_gpus: typing.Optional[bool] = None, **model_kwargs)


Generates sequences for models with a language modeling head using beam search decoding.

> Parameters


- **input_ids** (`torch.LongTensor` of shape `(batch_size, sequence_length)`) --
  The sequence used as a prompt for the generation.
- **beam_scorer** (`BeamScorer`) --
  An derived instance of [BeamScorer](/docs/transformers/master/en/internal/generation_utils.html#transformers.BeamScorer) that defines how beam hypotheses are
  constructed, stored and sorted during generation. For more information, the documentation of
  [BeamScorer](/docs/transformers/master/en/internal/generation_utils.html#transformers.BeamScorer) should be read.
- **logits_processor** (`LogitsProcessorList`, _optional_) --
  An instance of [LogitsProcessorList](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessorList). List of instances of class derived from
  [LogitsProcessor](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessor) used to modify the prediction scores of the language modeling
  head applied at each generation step.
- **stopping_criteria** (`StoppingCriteriaList`, _optional_) --
  An instance of [StoppingCriteriaList](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteriaList). List of instances of class derived from
  [StoppingCriteria](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteria) used to tell if the generation loop should stop.
- **max_length** (`int`, _optional_, defaults to 20) --
  **DEPRECATED**. Use `logits_processor` or `stopping_criteria` directly to cap the number of
  generated tokens. The maximum length of the sequence to be generated.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **output_attentions** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the attentions tensors of all attention layers. See `attentions` under
  returned tensors for more details.
- **output_hidden_states** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the hidden states of all layers. See `hidden_states` under returned tensors
  for more details.
- **output_scores** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the prediction scores. See `scores` under returned tensors for more details.
- **return_dict_in_generate** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return a [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) instead of a plain tuple.
- **synced_gpus** (`bool`, _optional_, defaults to `False`) --
  Whether to continue running the while loop until max_length (needed for ZeRO stage 3)

  model_kwargs --
  Additional model specific kwargs that will be forwarded to the `forward` function of the model. If
  model is an encoder-decoder model the kwargs should include `encoder_outputs`.

> Returns

[BeamSearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchDecoderOnlyOutput),
[BeamSearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchEncoderDecoderOutput) or obj:_torch.LongTensor_: A
`torch.LongTensor` containing the generated tokens (default behaviour) or a
[BeamSearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchDecoderOnlyOutput) if
[BeamSearchDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchDecoderOnlyOutput) if
`model.config.is_encoder_decoder=False` and `return_dict_in_generate=True` or a
[BeamSearchEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.BeamSearchEncoderDecoderOutput) if
`model.config.is_encoder_decoder=True`.

> Examples:

```python
>>> from transformers import (
...    AutoTokenizer,
...    AutoModelForSeq2SeqLM,
...    LogitsProcessorList,
...    MinLengthLogitsProcessor,
...    HammingDiversityLogitsProcessor,
...    BeamSearchScorer,
... )
>>> import torch

>>> tokenizer = AutoTokenizer.from_pretrained("t5-base")
>>> model = AutoModelForSeq2SeqLM.from_pretrained("t5-base")

>>> encoder_input_str = "translate English to German: How old are you?"
>>> encoder_input_ids = tokenizer(encoder_input_str, return_tensors="pt").input_ids


>>> # lets run diverse beam search using 6 beams
>>> num_beams = 6
>>> # define decoder start token ids
>>> input_ids = torch.ones((num_beams, 1), device=model.device, dtype=torch.long)
>>> input_ids = input_ids * model.config.decoder_start_token_id

>>> # add encoder_outputs to model keyword arguments
>>> model_kwargs = &amp;lcub;
...     "encoder_outputs": model.get_encoder()(encoder_input_ids.repeat_interleave(num_beams, dim=0), return_dict=True)
... }

>>> # instantiate beam scorer
>>> beam_scorer = BeamSearchScorer(
...     batch_size=1,
...     max_length=model.config.max_length,
...     num_beams=num_beams,
...     device=model.device,
...     num_beam_groups=3
... )

>>> # instantiate logits processors
>>> logits_processor = LogitsProcessorList([
...     HammingDiversityLogitsProcessor(5.5, num_beams=6, num_beam_groups=3),
...     MinLengthLogitsProcessor(5, eos_token_id=model.config.eos_token_id),
... ])

>>> outputs = model.group_beam_search(input_ids, beam_scorer, logits_processor=logits_processor, **model_kwargs)

>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))
```


<a id='transformers.generation_utils.GenerationMixin.prepare_inputs_for_generation'></a>
> **prepare\_inputs\_for\_generation**(self, input_ids: LongTensor, **kwargs)


Implement in subclasses of [PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel) for custom behavior to prepare inputs in the
generate method.


<a id='transformers.generation_utils.GenerationMixin.sample'></a>
> **sample**(self, input_ids: LongTensor, logits_processor: typing.Optional[transformers.generation_logits_process.LogitsProcessorList] = None, stopping_criteria: typing.Optional[transformers.generation_stopping_criteria.StoppingCriteriaList] = None, logits_warper: typing.Optional[transformers.generation_logits_process.LogitsProcessorList] = None, max_length: typing.Optional[int] = None, pad_token_id: typing.Optional[int] = None, eos_token_id: typing.Optional[int] = None, output_attentions: typing.Optional[bool] = None, output_hidden_states: typing.Optional[bool] = None, output_scores: typing.Optional[bool] = None, return_dict_in_generate: typing.Optional[bool] = None, synced_gpus: typing.Optional[bool] = None, **model_kwargs)


Generates sequences for models with a language modeling head using multinomial sampling.

> Parameters


- **input_ids** (`torch.LongTensor` of shape `(batch_size, sequence_length)`) --
  The sequence used as a prompt for the generation.
- **logits_processor** (`LogitsProcessorList`, _optional_) --
  An instance of [LogitsProcessorList](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessorList). List of instances of class derived from
  [LogitsProcessor](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessor) used to modify the prediction scores of the language modeling
  head applied at each generation step.
- **stopping_criteria** (`StoppingCriteriaList`, _optional_) --
  An instance of [StoppingCriteriaList](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteriaList). List of instances of class derived from
  [StoppingCriteria](/docs/transformers/master/en/internal/generation_utils.html#transformers.StoppingCriteria) used to tell if the generation loop should stop.
- **logits_warper** (`LogitsProcessorList`, _optional_) --
  An instance of [LogitsProcessorList](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsProcessorList). List of instances of class derived from
  [LogitsWarper](/docs/transformers/master/en/internal/generation_utils.html#transformers.LogitsWarper) used to warp the prediction score distribution of the language
  modeling head applied before multinomial sampling at each generation step.
- **max_length** (`int`, _optional_, defaults to 20) --
  **DEPRECATED**. Use `logits_processor` or `stopping_criteria` directly to cap the number of
  generated tokens. The maximum length of the sequence to be generated.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **output_attentions** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the attentions tensors of all attention layers. See `attentions` under
  returned tensors for more details.
- **output_hidden_states** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the hidden states of all layers. See `hidden_states` under returned tensors
  for more details.
- **output_scores** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the prediction scores. See `scores` under returned tensors for more details.
- **return_dict_in_generate** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return a [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) instead of a plain tuple.
- **synced_gpus** (`bool`, _optional_, defaults to `False`) --
  Whether to continue running the while loop until max_length (needed for ZeRO stage 3)
  model_kwargs --
  Additional model specific kwargs will be forwarded to the `forward` function of the model. If
  model is an encoder-decoder model the kwargs should include `encoder_outputs`.

> Returns

[SampleDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.SampleDecoderOnlyOutput),
[SampleEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.SampleEncoderDecoderOutput) or obj:_torch.LongTensor_: A
`torch.LongTensor` containing the generated tokens (default behaviour) or a
[SampleDecoderOnlyOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.SampleDecoderOnlyOutput) if
`model.config.is_encoder_decoder=False` and `return_dict_in_generate=True` or a
[SampleEncoderDecoderOutput](/docs/transformers/master/en/internal/generation_utils.html#transformers.generation_utils.SampleEncoderDecoderOutput) if
`model.config.is_encoder_decoder=True`.

> Examples:

```python
>>> from transformers import (
...    AutoTokenizer,
...    AutoModelForCausalLM,
...    LogitsProcessorList,
...    MinLengthLogitsProcessor,
...    TopKLogitsWarper,
...    TemperatureLogitsWarper,
... )

>>> tokenizer = AutoTokenizer.from_pretrained("gpt2")
>>> model = AutoModelForCausalLM.from_pretrained("gpt2")

>>> # set pad_token_id to eos_token_id because GPT2 does not have a EOS token
>>> model.config.pad_token_id = model.config.eos_token_id

>>> input_prompt = "Today is a beautiful day, and"
>>> input_ids = tokenizer(input_prompt, return_tensors="pt").input_ids

>>> # instantiate logits processors
>>> logits_processor = LogitsProcessorList([
...     MinLengthLogitsProcessor(15, eos_token_id=model.config.eos_token_id),
... ])
>>> # instantiate logits processors
>>> logits_warper = LogitsProcessorList([
...     TopKLogitsWarper(50),
...     TemperatureLogitsWarper(0.7),
... ])

>>> outputs = model.sample(input_ids, logits_processor=logits_processor, logits_warper=logits_warper)

>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))
```


<a id='transformers.generation_tf_utils.TFGenerationMixin'></a>
> **class transformers.generation\_tf\_utils.TFGenerationMixin**()


A class containing all of the functions supporting generation, to be used as a mixin in
[TFPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel).


<a id='transformers.generation_tf_utils.TFGenerationMixin.adjust_logits_during_generation'></a>
> **adjust\_logits\_during\_generation**(self, logits, cur_len, max_length, forced_bos_token_id, forced_eos_token_id, **kwargs)


Implement in subclasses of [PreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.PreTrainedModel) for custom behavior to adjust the logits in
the generate method.


<a id='transformers.generation_tf_utils.TFGenerationMixin.generate'></a>
> **generate**(self, input_ids = None, max_length = None, min_length = None, do_sample = None, early_stopping = None, num_beams = None, temperature = None, top_k = None, top_p = None, repetition_penalty = None, bad_words_ids = None, bos_token_id = None, pad_token_id = None, eos_token_id = None, length_penalty = None, no_repeat_ngram_size = None, num_return_sequences = None, attention_mask = None, decoder_start_token_id = None, use_cache = None, output_scores = None, output_attentions = None, output_hidden_states = None, return_dict_in_generate = None, forced_bos_token_id = None, forced_eos_token_id = None, **model_kwargs)


Generates sequences for models with a language modeling head. The method currently supports greedy decoding,
beam-search decoding, sampling with temperature, sampling with top-k or nucleus sampling.

Adapted in part from [Facebook's XLM beam search code](https://github.com/facebookresearch/XLM/blob/9e6f6814d17be4fe5b15f2e6c43eb2b2d76daeb4/src/model/transformer.py#L529).

Apart from `input_ids` and `attention_mask`, all the arguments below will default to the value of the
attribute of the same name inside the [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig) of the model. The default values
indicated are the default values of those config.

Most of these parameters are explained in more detail in [this blog post](https://huggingface.co/blog/how-to-generate).

> Parameters


- **input_ids** (`tf.Tensor` of `dtype=tf.int32` and shape `(batch_size, sequence_length)`, _optional_) --
  The sequence used as a prompt for the generation. If `None` the method initializes it with
  `bos_token_id` and a batch size of 1.
- **max_length** (`int`, _optional_, defaults to 20) --
  The maximum length of the sequence to be generated.
- **min_length** (`int`, _optional_, defaults to 10) --
  The minimum length of the sequence to be generated.
- **do_sample** (`bool`, _optional_, defaults to `False`) --
  Whether or not to use sampling ; use greedy decoding otherwise.
- **early_stopping** (`bool`, _optional_, defaults to `False`) --
  Whether to stop the beam search when at least `num_beams` sentences are finished per batch or not.
- **num_beams** (`int`, _optional_, defaults to 1) --
  Number of beams for beam search. 1 means no beam search.
- **temperature** (`float`, _optional_, defaults to 1.0) --
  The value used to module the next token probabilities.
- **top_k** (`int`, _optional_, defaults to 50) --
  The number of highest probability vocabulary tokens to keep for top-k-filtering.
- **top_p** (`float`, _optional_, defaults to 1.0) --
  If set to float &amp;lt; 1, only the most probable tokens with probabilities that add up to `top_p` or
  higher are kept for generation.
- **repetition_penalty** (`float`, _optional_, defaults to 1.0) --
  The parameter for repetition penalty. 1.0 means no penalty. See [this paper](https://arxiv.org/pdf/1909.05858.pdf) for more details.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **bos_token_id** (`int`, _optional_) --
  The id of the _beginning-of-sequence_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **length_penalty** (`float`, _optional_, defaults to 1.0) --
  Exponential penalty to the length. 1.0 means no penalty.

  Set to values &amp;lt; 1.0 in order to encourage the model to generate shorter sequences, to a value > 1.0 in
  order to encourage the model to produce longer sequences.
- **no_repeat_ngram_size** (`int`, _optional_, defaults to 0) --
  If set to int > 0, all ngrams of that size can only occur once.
- **bad_words_ids(`List[int]`,** _optional_) --
  List of token ids that are not allowed to be generated. In order to get the tokens of the words that
  should not appear in the generated text, use `tokenizer.encode(bad_word, add_prefix_space=True)`.
- **num_return_sequences(`int`,** _optional_, defaults to 1) --
  The number of independently computed returned sequences for each element in the batch.
- **attention_mask** (`tf.Tensor` of `dtype=tf.int32` and shape `(batch_size, sequence_length)`, _optional_) --
  Mask to avoid performing attention on padding token indices. Mask values are in `[0, 1]`, 1 for
  tokens that are not masked, and 0 for masked tokens.

  If not provided, will default to a tensor the same shape as `input_ids` that masks the pad token.

  [What are attention masks?](../glossary.html#attention-mask)
- **decoder_start_token_id** (`int`, _optional_) --
  If an encoder-decoder model starts decoding with a different token than _bos_, the id of that token.
  use_cache -- (`bool`, _optional_, defaults to `True`):
  Whether or not the model should use the past last key/values attentions (if applicable to the model) to
  speed up decoding.
- **output_attentions** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the attentions tensors of all attention layers. See `attentions` under
  returned tensors for more details.
- **output_hidden_states** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the hidden states of all layers. See `hidden_states` under returned tensors
  for more details.
- **output_scores** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return the prediction scores. See `scores` under returned tensors for more details.
- **return_dict_in_generate** (`bool`, _optional_, defaults to _False_) --
  Whether or not to return a [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) instead of a plain tuple.
- **forced_bos_token_id** (`int`, _optional_) --
  The id of the token to force as the first generated token after the `decoder_start_token_id`.
  Useful for multilingual models like [mBART](/docs/transformers/master/en/../model_doc/mbart.html) where the first generated token
  needs to be the target language token.
- **forced_eos_token_id** (`int`, _optional_) --
  The id of the token to force as the last generated token when `max_length` is reached.
  model_specific_kwargs --
  Additional model specific kwargs will be forwarded to the `forward` function of the model.

> Returns

A
[ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) (if `return_dict_in_generate=True` or when
`config.return_dict_in_generate=True`) or a `tf.Tensor`.

If the model is _not_ an encoder-decoder model (`model.config.is_encoder_decoder=False`), the
possible [ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) types are:

- `TFGreedySearchDecoderOnlyOutput`,
- `TFSampleDecoderOnlyOutput`,
- `TFBeamSearchDecoderOnlyOutput`,
- `TFBeamSampleDecoderOnlyOutput`

If the model is an encoder-decoder model (`model.config.is_encoder_decoder=True`), the possible
[ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) types are:

- `TFGreedySearchEncoderDecoderOutput`,
- `TFSampleEncoderDecoderOutput`,
- `TFBeamSearchEncoderDecoderOutput`,
- `TFBeamSampleEncoderDecoderOutput`

> Return type

[ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput) or `tf.Tensor`

> Examples:

```python
tokenizer = AutoTokenizer.from_pretrained('distilgpt2')   # Initialize tokenizer
model = TFAutoModelWithLMHead.from_pretrained('distilgpt2')    # Download model and configuration from huggingface.co and cache.
outputs = model.generate(max_length=40)  # do greedy decoding
print(f'Generated: &amp;lcub;tokenizer.decode(outputs[0], skip_special_tokens=True)}')

tokenizer = AutoTokenizer.from_pretrained('openai-gpt')   # Initialize tokenizer
model = TFAutoModelWithLMHead.from_pretrained('openai-gpt')    # Download model and configuration from huggingface.co and cache.
input_context = 'The dog'
input_ids = tokenizer.encode(input_context, return_tensors='tf')  # encode input context
outputs = model.generate(input_ids=input_ids, num_beams=5, num_return_sequences=3, temperature=1.5)  # generate 3 independent sequences using beam search decoding (5 beams) with sampling from initial context 'The dog'
for i in range(3): #  3 output sequences were generated
print(f'Generated &amp;lcub;i}: &amp;lcub;tokenizer.decode(outputs[i], skip_special_tokens=True)}')

tokenizer = AutoTokenizer.from_pretrained('distilgpt2')   # Initialize tokenizer
model = TFAutoModelWithLMHead.from_pretrained('distilgpt2')    # Download model and configuration from huggingface.co and cache.
input_context = 'The dog'
input_ids = tokenizer.encode(input_context, return_tensors='tf')  # encode input context
outputs = model.generate(input_ids=input_ids, max_length=40, temperature=0.7, num_return_sequences=3, do_sample=True)  # generate 3 candidates using sampling
for i in range(3): #  3 output sequences were generated
print(f'Generated &amp;lcub;i}: &amp;lcub;tokenizer.decode(outputs[i], skip_special_tokens=True)}')

tokenizer = AutoTokenizer.from_pretrained('ctrl')   # Initialize tokenizer
model = TFAutoModelWithLMHead.from_pretrained('ctrl')    # Download model and configuration from huggingface.co and cache.
input_context = 'Legal My neighbor is'  # "Legal" is one of the control codes for ctrl
input_ids = tokenizer.encode(input_context, return_tensors='tf')  # encode input context
outputs = model.generate(input_ids=input_ids, max_length=50, temperature=0.7, repetition_penalty=1.2)  # generate sequences
print(f'Generated: &amp;lcub;tokenizer.decode(outputs[0], skip_special_tokens=True)}')

tokenizer = AutoTokenizer.from_pretrained('gpt2')   # Initialize tokenizer
model = TFAutoModelWithLMHead.from_pretrained('gpt2')    # Download model and configuration from huggingface.co and cache.
input_context = 'My cute dog'
bad_words_ids = [tokenizer.encode(bad_word, add_prefix_space=True) for bad_word in ['idiot', 'stupid', 'shut up']]
input_ids = tokenizer.encode(input_context, return_tensors='tf')  # encode input context
outputs = model.generate(input_ids=input_ids, max_length=100, do_sample=True, bad_words_ids=bad_words_ids)  # generate sequences without allowing bad_words to be generated
```


<a id='transformers.generation_tf_utils.TFGenerationMixin.prepare_inputs_for_generation'></a>
> **prepare\_inputs\_for\_generation**(self, inputs, **kwargs)


Implement in subclasses of [TFPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.TFPreTrainedModel) for custom behavior to prepare inputs in
the generate method.


<a id='transformers.generation_flax_utils.FlaxGenerationMixin'></a>
> **class transformers.generation\_flax\_utils.FlaxGenerationMixin**()


A class containing all of the functions supporting generation, to be used as a mixin in
[FlaxPreTrainedModel](/docs/transformers/master/en/main_classes/model.html#transformers.FlaxPreTrainedModel).


<a id='transformers.generation_flax_utils.FlaxGenerationMixin.generate'></a>
> **generate**(self, input_ids: ndarray, max_length: typing.Optional[int] = None, pad_token_id: typing.Optional[int] = None, bos_token_id: typing.Optional[int] = None, eos_token_id: typing.Optional[int] = None, decoder_start_token_id: typing.Optional[int] = None, do_sample: typing.Optional[bool] = None, prng_key: typing.Optional[jax._src.numpy.lax_numpy.ndarray] = None, top_k: typing.Optional[int] = None, top_p: typing.Optional[float] = None, temperature: typing.Optional[float] = None, num_beams: typing.Optional[int] = None, no_repeat_ngram_size: typing.Optional[int] = None, min_length: typing.Optional[int] = None, forced_bos_token_id: typing.Optional[int] = None, forced_eos_token_id: typing.Optional[int] = None, length_penalty: typing.Optional[float] = None, early_stopping: typing.Optional[bool] = None, trace: bool = True, params: typing.Union[typing.Dict[str, jax._src.numpy.lax_numpy.ndarray], NoneType] = None, **model_kwargs)


Generates sequences for models with a language modeling head. The method currently supports greedy decoding,
and, multinomial sampling.

Apart from `input_ids`, all the arguments below will default to the value of the attribute of the same
name inside the [PretrainedConfig](/docs/transformers/master/en/main_classes/configuration.html#transformers.PretrainedConfig) of the model. The default values indicated are the
default values of those config.

Most of these parameters are explained in more detail in [this blog post](https://huggingface.co/blog/how-to-generate).

> Parameters


- **input_ids** (`jnp.ndarray` of shape `(batch_size, sequence_length)`) --
  The sequence used as a prompt for the generation.
- **max_length** (`int`, _optional_, defaults to 20) --
  The maximum length of the sequence to be generated.
- **do_sample** (`bool`, _optional_, defaults to `False`) --
  Whether or not to use sampling ; use greedy decoding otherwise.
- **temperature** (`float`, _optional_, defaults to 1.0) --
  The value used to module the next token probabilities.
- **top_k** (`int`, _optional_, defaults to 50) --
  The number of highest probability vocabulary tokens to keep for top-k-filtering.
- **top_p** (`float`, _optional_, defaults to 1.0) --
  If set to float &amp;lt; 1, only the most probable tokens with probabilities that add up to `top_p` or
  higher are kept for generation.
- **pad_token_id** (`int`, _optional_) --
  The id of the _padding_ token.
- **bos_token_id** (`int`, _optional_) --
  The id of the _beginning-of-sequence_ token.
- **eos_token_id** (`int`, _optional_) --
  The id of the _end-of-sequence_ token.
- **num_beams** (`int`, _optional_, defaults to 1) --
  Number of beams for beam search. 1 means no beam search.
- **decoder_start_token_id** (`int`, _optional_) --
  If an encoder-decoder model starts decoding with a different token than _bos_, the id of that token.
- **trace** (`bool`, _optional_, defaults to `True`) --
  Whether to trace generation. Setting `trace=False` should only be used for debugging and will lead to
  a considerably slower runtime.
- **params** (`Dict[str, jnp.ndarray]`, _optional_) --
  Optionally the model parameters can be passed. Can be useful for parallelized generation.
  model_kwargs --
  Additional model specific kwargs will be forwarded to the `forward` function of the model.

> Returns

[ModelOutput](/docs/transformers/master/en/main_classes/output.html#transformers.file_utils.ModelOutput).

> Examples:

```python
>>> from transformers import AutoTokenizer, FlaxAutoModelForCausalLM

>>> tokenizer = AutoTokenizer.from_pretrained("distilgpt2")
>>> model = FlaxAutoModelForCausalLM.from_pretrained("distilgpt2")
>>> input_context = "The dog"
>>> # encode input context
>>> input_ids = tokenizer(input_context, return_tensors="np").input_ids
>>> # generate candidates using sampling
>>> outputs = model.generate(input_ids=input_ids, max_length=20, top_k=30, do_sample=True)
>>> print("Generated:", tokenizer.batch_decode(outputs, skip_special_tokens=True))
```


## Pushing to the Hub

<a id='transformers.file_utils.PushToHubMixin'></a>
> **class transformers.file\_utils.PushToHubMixin**()


A Mixin containing the functionality to push a model or tokenizer to the hub.


<a id='transformers.file_utils.PushToHubMixin.push_to_hub'></a>
> **push\_to\_hub**(self, repo_path_or_name: typing.Optional[str] = None, repo_url: typing.Optional[str] = None, use_temp_dir: bool = False, commit_message: typing.Optional[str] = None, organization: typing.Optional[str] = None, private: typing.Optional[bool] = None, use_auth_token: typing.Union[bool, str, NoneType] = None)


Upload the &amp;lcub;object_files} to the ðŸ¤— Model Hub while synchronizing a local clone of the repo in
`repo_path_or_name`.

> Parameters

- **repo_path_or_name** (`str`, _optional_) --
  Can either be a repository name for your &amp;lcub;object} in the Hub or a path to a local folder (in which case
  the repository will have the name of that local folder). If not specified, will default to the name
  given by `repo_url` and a local directory with that name will be created.
- **repo_url** (`str`, _optional_) --
  Specify this in case you want to push to an existing repository in the hub. If unspecified, a new
  repository will be created in your namespace (unless you specify an `organization`) with
  `repo_name`.
- **use_temp_dir** (`bool`, _optional_, defaults to `False`) --
  Whether or not to clone the distant repo in a temporary directory or in `repo_path_or_name` inside
  the current working directory. This will slow things down if you are making changes in an existing repo
  since you will need to clone the repo before every push.
- **commit_message** (`str`, _optional_) --
  Message to commit while pushing. Will default to `"add &amp;lcub;object}"`.
- **organization** (`str`, _optional_) --
  Organization in which you want to push your &amp;lcub;object} (you must be a member of this organization).
- **private** (`bool`, _optional_) --
  Whether or not the repository created should be private (requires a paying subscription).
- **use_auth_token** (`bool` or `str`, _optional_) --
  The token to use as HTTP bearer authorization for remote files. If `True`, will use the token
  generated when running `transformers-cli login` (stored in `~/.huggingface`). Will default to
  `True` if `repo_url` is not specified.


> Returns

The url of the commit of your &amp;lcub;object} in the given repository.

> Return type

`str`

> Examples:

```python
from transformers import &amp;lcub;object_class}

&amp;lcub;object} = &amp;lcub;object_class}.from_pretrained("bert-base-cased")

# Push the &amp;lcub;object} to your namespace with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
&amp;lcub;object}.push_to_hub("my-finetuned-bert")

# Push the &amp;lcub;object} to your namespace with the name "my-finetuned-bert" with no local clone.
&amp;lcub;object}.push_to_hub("my-finetuned-bert", use_temp_dir=True)

# Push the &amp;lcub;object} to an organization with the name "my-finetuned-bert" and have a local clone in the
# _my-finetuned-bert_ folder.
&amp;lcub;object}.push_to_hub("my-finetuned-bert", organization="huggingface")

# Make a change to an existing repo that has been cloned locally in _my-finetuned-bert_.
&amp;lcub;object}.push_to_hub("my-finetuned-bert", repo_url="https://huggingface.co/sgugger/my-finetuned-bert")
```

