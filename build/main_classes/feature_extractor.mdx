<script>
import Tip from "../../Tip.svelte";
import Youtube from "../../Youtube.svelte";	
export let fw: "pt" | "tf"
</script>

<!--Copyright 2021 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
-->

# Feature Extractor

A feature extractor is in charge of preparing input features for a multi-modal model. This includes feature extraction
from sequences, *e.g.*, pre-processing audio files to Log-Mel Spectrogram features, feature extraction from images
*e.g.* cropping image image files, but also padding, normalization, and conversion to Numpy, PyTorch, and TensorFlow
tensors.


## FeatureExtractionMixin

<a id='transformers.feature_extraction_utils.FeatureExtractionMixin'></a>
> **class transformers.feature\_extraction\_utils.FeatureExtractionMixin**(**kwargs)


This is a feature extraction mixin used to provide saving/loading functionality for sequential and image feature
extractors.


<a id='transformers.feature_extraction_utils.FeatureExtractionMixin.from_pretrained'></a>
> **from\_pretrained**(pretrained_model_name_or_path: typing.Union[str, os.PathLike], **kwargs)


Instantiate a type of [FeatureExtractionMixin](main_classes/feature_extractor.html#transformers.feature_extraction_utils.FeatureExtractionMixin) from a feature
extractor, *e.g.* a derived class of [SequenceFeatureExtractor](main_classes/feature_extractor.html#transformers.SequenceFeatureExtractor).

> Parameters

- **pretrained_model_name_or_path** (`str` or `os.PathLike`) --
  This can be either:

  - a string, the _model id_ of a pretrained feature_extractor hosted inside a model repo on
    huggingface.co. Valid model ids can be located at the root-level, like `bert-base-uncased`, or
    namespaced under a user or organization name, like `dbmdz/bert-base-german-cased`.
  - a path to a _directory_ containing a feature extractor file saved using the
    [save_pretrained()](main_classes/feature_extractor.html#transformers.feature_extraction_utils.FeatureExtractionMixin.save_pretrained) method, e.g.,
    `./my_model_directory/`.
  - a path or url to a saved feature extractor JSON _file_, e.g.,
    `./my_model_directory/preprocessor_config.json`.
- **cache_dir** (`str` or `os.PathLike`, _optional_) --
  Path to a directory in which a downloaded pretrained model feature extractor should be cached if the
  standard cache should not be used.
- **force_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to force to (re-)download the feature extractor files and override the cached versions
  if they exist.
- **resume_download** (`bool`, _optional_, defaults to `False`) --
  Whether or not to delete incompletely received file. Attempts to resume the download if such a file
  exists.
- **proxies** (`Dict[str, str]`, _optional_) --
  A dictionary of proxy servers to use by protocol or endpoint, e.g., `&lcub'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}.` The proxies are used on each request.
- **use_auth_token** (`str` or _bool_, _optional_) --
  The token to use as HTTP bearer authorization for remote files. If `True`, will use the token
  generated when running `transformers-cli login` (stored in `~/.huggingface`).
- **revision(`str`,** _optional_, defaults to `"main"`) --
  The specific model version to use. It can be a branch name, a tag name, or a commit id, since we use a
  git-based system for storing models and other artifacts on huggingface.co, so `revision` can be any
  identifier allowed by git.
- **return_unused_kwargs** (`bool`, _optional_, defaults to `False`) --
  If `False`, then this function returns just the final feature extractor object. If `True`,
  then this functions returns a `Tuple(feature_extractor, unused_kwargs)` where _unused_kwargs_ is a
  dictionary consisting of the key/value pairs whose keys are not feature extractor attributes: i.e., the
  part of `kwargs` which has not been used to update `feature_extractor` and is otherwise ignored.
- **kwargs** (`Dict[str, Any]`, _optional_) --
  The values in kwargs of any keys which are feature extractor attributes will be used to override the
  loaded values. Behavior concerning key/value pairs whose keys are *not* feature extractor attributes is
  controlled by the `return_unused_kwargs` keyword parameter.

<Tip>

Passing `use_auth_token=True` is required when you want to use a private model.

</Tip>

> Returns

A feature extractor of type [FeatureExtractionMixin](main_classes/feature_extractor.html#transformers.feature_extraction_utils.FeatureExtractionMixin).

> Examples:

```python
# We can't instantiate directly the base class _FeatureExtractionMixin_ nor _SequenceFeatureExtractor_ so let's show the examples on a
# derived class: _Wav2Vec2FeatureExtractor_
feature_extractor = Wav2Vec2FeatureExtractor.from_pretrained('facebook/wav2vec2-base-960h')    # Download feature_extraction_config from huggingface.co and cache.
feature_extractor = Wav2Vec2FeatureExtractor.from_pretrained('./test/saved_model/')  # E.g. feature_extractor (or model) was saved using _save_pretrained('./test/saved_model/')_
feature_extractor = Wav2Vec2FeatureExtractor.from_pretrained('./test/saved_model/preprocessor_config.json')
feature_extractor = Wav2Vec2FeatureExtractor.from_pretrained('facebook/wav2vec2-base-960h', return_attention_mask=False, foo=False)
assert feature_extractor.return_attention_mask is False
feature_extractor, unused_kwargs = Wav2Vec2FeatureExtractor.from_pretrained('facebook/wav2vec2-base-960h', return_attention_mask=False,
foo=False, return_unused_kwargs=True)
assert feature_extractor.return_attention_mask is False
assert unused_kwargs == &lcub'foo': False}
```


<a id='transformers.feature_extraction_utils.FeatureExtractionMixin.save_pretrained'></a>
> **save\_pretrained**(self, save_directory: typing.Union[str, os.PathLike])


Save a feature_extractor object to the directory `save_directory`, so that it can be re-loaded using the
[from_pretrained()](main_classes/feature_extractor.html#transformers.feature_extraction_utils.FeatureExtractionMixin.from_pretrained) class method.

> Parameters

- **save_directory** (`str` or `os.PathLike`) --
  Directory where the feature extractor JSON file will be saved (will be created if it does not exist).


## SequenceFeatureExtractor

<a id='transformers.SequenceFeatureExtractor'></a>
> **class transformers.SequenceFeatureExtractor**(feature_size: int, sampling_rate: int, padding_value: float, **kwargs)


This is a general feature extraction class for speech recognition.

> Parameters

- **feature_size** (`int`) --
  The feature dimension of the extracted features.
- **sampling_rate** (`int`) --
  The sampling rate at which the audio files should be digitalized expressed in Hertz per second (Hz).
- **padding_value** (`float`) --
  The value that is used to fill the padding values / vectors.


<a id='transformers.SequenceFeatureExtractor.pad'></a>
> **pad**(self, processed_features: typing.Union[transformers.feature_extraction_utils.BatchFeature, typing.List[transformers.feature_extraction_utils.BatchFeature], typing.Dict[str, transformers.feature_extraction_utils.BatchFeature], typing.Dict[str, typing.List[transformers.feature_extraction_utils.BatchFeature]], typing.List[typing.Dict[str, transformers.feature_extraction_utils.BatchFeature]]], padding: typing.Union[bool, str, transformers.file_utils.PaddingStrategy] = True, max_length: typing.Optional[int] = None, truncation: bool = False, pad_to_multiple_of: typing.Optional[int] = None, return_attention_mask: typing.Optional[bool] = None, return_tensors: typing.Union[str, transformers.file_utils.TensorType, NoneType] = None)


Pad input values / input vectors or a batch of input values / input vectors up to predefined length or to the
max sequence length in the batch.

Padding side (left/right) padding values are defined at the feature extractor level (with
`self.padding_side`, `self.padding_value`)

<Tip>

If the `processed_features` passed are dictionary of numpy arrays, PyTorch tensors or TensorFlow tensors,
the result will use the same type unless you provide a different tensor type with `return_tensors`. In
the case of PyTorch tensors, you will lose the specific device of your tensors however.

</Tip>

> Parameters

- **processed_features** ([BatchFeature](main_classes/feature_extractor.html#transformers.BatchFeature), list of [BatchFeature](main_classes/feature_extractor.html#transformers.BatchFeature), `Dict[str, List[float]]`, `Dict[str, List[List[float]]` or `List[Dict[str, List[float]]]`) --
  Processed inputs. Can represent one input ([BatchFeature](main_classes/feature_extractor.html#transformers.BatchFeature) or `Dict[str, List[float]]`) or a batch of input values / vectors (list of [BatchFeature](main_classes/feature_extractor.html#transformers.BatchFeature),
  _Dict[str, List[List[float]]]_ or _List[Dict[str, List[float]]]_) so you can use this method during
  preprocessing as well as in a PyTorch Dataloader collate function.

  Instead of `List[float]` you can have tensors (numpy arrays, PyTorch tensors or TensorFlow
  tensors), see the note above for the return type.
- **padding** (`bool`, `str` or [PaddingStrategy](internal/file_utils.html#transformers.file_utils.PaddingStrategy), _optional_, defaults to `True`) --
  Select a strategy to pad the returned sequences (according to the model's padding side and padding
  index) among:

  - `True` or `'longest'`: Pad to the longest sequence in the batch (or no padding if only a
    single sequence if provided).
  - `'max_length'`: Pad to a maximum length specified with the argument `max_length` or to the
    maximum acceptable input length for the model if that argument is not provided.
  - `False` or `'do_not_pad'` (default): No padding (i.e., can output a batch with sequences of
    different lengths).
- **max_length** (`int`, _optional_) --
  Maximum length of the returned list and optionally padding length (see above).
- **truncation** (`bool`) --
  Activates truncation to cut input sequences longer than `max_length` to `max_length`.
- **pad_to_multiple_of** (`int`, _optional_) --
  If set will pad the sequence to a multiple of the provided value.

  This is especially useful to enable the use of Tensor Cores on NVIDIA hardware with compute capability
  >= 7.5 (Volta), or on TPUs which benefit from having sequence lengths be a multiple of 128.
- **return_attention_mask** (`bool`, _optional_) --
  Whether to return the attention mask. If left to the default, will return the attention mask according
  to the specific feature_extractor's default.

  [What are attention masks?](../glossary.html#attention-mask)
- **return_tensors** (`str` or [TensorType](internal/file_utils.html#transformers.TensorType), _optional_) --
  If set, will return tensors instead of list of python integers. Acceptable values are:

  - `'tf'`: Return TensorFlow `tf.constant` objects.
  - `'pt'`: Return PyTorch `torch.Tensor` objects.
  - `'np'`: Return Numpy `np.ndarray` objects.


## BatchFeature

<a id='transformers.BatchFeature'></a>
> **class transformers.BatchFeature**(data: typing.Union[typing.Dict[str, typing.Any], NoneType] = None, tensor_type: typing.Union[NoneType, str, transformers.file_utils.TensorType] = None)


Holds the output of the [pad()](main_classes/feature_extractor.html#transformers.SequenceFeatureExtractor.pad) and feature extractor specific
`__call__` methods.

This class is derived from a python dictionary and can be used as a dictionary.

> Parameters

- **data** (`dict`) --
  Dictionary of lists/arrays/tensors returned by the __call__/pad methods ('input_values', 'attention_mask',
  etc.).
- **tensor_type** (`Union[None, str, TensorType]`, _optional_) --
  You can give a tensor_type here to convert the lists of integers in PyTorch/TensorFlow/Numpy Tensors at
  initialization.


<a id='transformers.BatchFeature.convert_to_tensors'></a>
> **convert\_to\_tensors**(self, tensor_type: typing.Union[str, transformers.file_utils.TensorType, NoneType] = None)


Convert the inner content to tensors.

> Parameters

- **tensor_type** (`str` or [TensorType](internal/file_utils.html#transformers.TensorType), _optional_) --
  The type of tensors to use. If `str`, should be one of the values of the enum
  [TensorType](internal/file_utils.html#transformers.TensorType). If `None`, no modification is done.


<a id='transformers.BatchFeature.to'></a>
> **to**(self, device: typing.Union[str, ForwardRef('torch.device')])


Send all values to device by calling `v.to(device)` (PyTorch only).

> Parameters

- **device** (`str` or `torch.device`) -- The device to put the tensors on.

> Returns

The same instance after modification.

> Return type

[BatchFeature](main_classes/feature_extractor.html#transformers.BatchFeature)


## ImageFeatureExtractionMixin

<a id='transformers.ImageFeatureExtractionMixin'></a>
> **class transformers.ImageFeatureExtractionMixin**()


Mixin that contain utilities for preparing image features.


<a id='transformers.ImageFeatureExtractionMixin.center_crop'></a>
> **center\_crop**(self, image, size)


Crops `image` to the given size using a center crop. Note that if the image is too small to be cropped to
the size given, it will be padded (so the returned result has the size asked).

> Parameters

- **image** (`PIL.Image.Image` or `np.ndarray` or `torch.Tensor`) --
  The image to resize.
- **size** (`int` or `Tuple[int, int]`) --
  The size to which crop the image.


<a id='transformers.ImageFeatureExtractionMixin.normalize'></a>
> **normalize**(self, image, mean, std)


Normalizes `image` with `mean` and `std`. Note that this will trigger a conversion of
`image` to a NumPy array if it's a PIL Image.

> Parameters

- **image** (`PIL.Image.Image` or `np.ndarray` or `torch.Tensor`) --
  The image to normalize.
- **mean** (`List[float]` or `np.ndarray` or `torch.Tensor`) --
  The mean (per channel) to use for normalization.
- **std** (`List[float]` or `np.ndarray` or `torch.Tensor`) --
  The standard deviation (per channel) to use for normalization.


<a id='transformers.ImageFeatureExtractionMixin.resize'></a>
> **resize**(self, image, size, resample = 2)


Resizes `image`. Note that this will trigger a conversion of `image` to a PIL Image.

> Parameters

- **image** (`PIL.Image.Image` or `np.ndarray` or `torch.Tensor`) --
  The image to resize.
- **size** (`int` or `Tuple[int, int]`) --
  The size to use for resizing the image.
- **resample** (`int`, _optional_, defaults to `PIL.Image.BILINEAR`) --
  The filter to user for resampling.


<a id='transformers.ImageFeatureExtractionMixin.to_numpy_array'></a>
> **to\_numpy\_array**(self, image, rescale = None, channel_first = True)


Converts `image` to a numpy array. Optionally rescales it and puts the channel dimension as the first
dimension.

> Parameters

- **image** (`PIL.Image.Image` or `np.ndarray` or `torch.Tensor`) --
  The image to convert to a NumPy array.
- **rescale** (`bool`, _optional_) --
  Whether or not to apply the scaling factor (to make pixel values floats between 0. and 1.). Will
  default to `True` if the image is a PIL Image or an array/tensor of integers, `False`
  otherwise.
- **channel_first** (`bool`, _optional_, defaults to `True`) --
  Whether or not to permute the dimensions of the image to put the channel dimension first.


<a id='transformers.ImageFeatureExtractionMixin.to_pil_image'></a>
> **to\_pil\_image**(self, image, rescale = None)


Converts `image` to a PIL Image. Optionally rescales it and puts the channel dimension back as the last
axis if needed.

> Parameters

- **image** (`PIL.Image.Image` or `numpy.ndarray` or `torch.Tensor`) --
  The image to convert to the PIL Image format.
- **rescale** (`bool`, _optional_) --
  Whether or not to apply the scaling factor (to make pixel values integers between 0 and 255). Will
  default to `True` if the image type is a floating type, `False` otherwise.

